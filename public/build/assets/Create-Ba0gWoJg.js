import{r as w,b as a,o as i,a as e,t as m,f as v,e as j,g as C,k as T,C as I,c as O,w as L,j as k,u as d,F as S,i as z,l as N,v as $,d as q,h as B}from"./app-Beo4ItwT.js";import{_ as E}from"./AdminSidebar-BEaC98-k.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./EllipsisHorizontalIcon-CXhkN-_T.js";import"./ChartBarIcon-CkJeh_d0.js";import"./UserIcon-CImU51LK.js";import"./CalendarIcon-0Nv1i96T.js";import"./CalendarDaysIcon-C_TLw00a.js";import"./DocumentTextIcon-DFEeVdHy.js";import"./UsersIcon-BZmjnOpW.js";const G={class:"flex flex-col mb-4"},H={class:"mb-2 font-medium text-purple-900"},R={key:0,class:"space-y-4"},K={key:0},W={key:1,class:"text-purple-600"},X={class:"font-medium"},Y={class:"text-sm"},J={key:2,class:"text-purple-600"},Q={class:"w-full bg-gray-200 rounded-full h-2 mt-2"},Z={key:1,class:"space-y-4"},ee={class:"bg-green-50 border border-green-200 rounded-lg p-4"},te={class:"flex items-center justify-between"},oe={class:"flex items-center"},se={class:"text-sm text-green-600"},le=["src"],re={__name:"VideoUploader",props:{label:{type:String,default:"Upload Video"},modelValue:{type:Object,default:null}},emits:["update:modelValue","video-uploaded"],setup(_,{emit:o}){const V=_,h=o,x=w(null),u=w(null),b=w(!1),r=w(0),t=w(V.modelValue),s=()=>{x.value.click()},p=n=>{const l=n.target.files[0];l&&F(l)&&(u.value=l)},c=n=>{const l=n.dataTransfer.files[0];l&&F(l)&&(u.value=l)},F=n=>["video/mp4","video/webm","video/ogg"].includes(n.type)?n.size>104857600?(alert("File size must be less than 100MB"),!1):!0:(alert("Please select a valid video file (MP4, WebM, or OGG)"),!1),D=n=>{if(n===0)return"0 Bytes";const l=1024,y=["Bytes","KB","MB","GB"],g=Math.floor(Math.log(n)/Math.log(l));return parseFloat((n/Math.pow(l,g)).toFixed(2))+" "+y[g]},P=async()=>{var n;if(u.value){b.value=!0,r.value=0;try{const l=setInterval(()=>{r.value<90&&(r.value+=Math.random()*10)},100),y=new FormData;y.append("files",u.value);const g=await fetch("/api/uploadthing",{method:"POST",body:y,headers:{"X-CSRF-TOKEN":((n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.getAttribute("content"))||"",Accept:"application/json"}});if(clearInterval(l),r.value=100,g.ok){const f=await g.json();if(f.success&&f.file){const M={name:f.file.name,size:f.file.size,url:f.file.url,key:f.file.key,type:"video"};t.value=M,h("update:modelValue",M),h("video-uploaded",M),u.value=null}else throw new Error(f.error||"Upload failed")}else{const f=await g.json().catch(()=>({}));throw new Error(f.error||`Upload failed with status ${g.status}`)}}catch(l){console.error("Upload error:",l),alert("Failed to upload video. Please try again.")}finally{b.value=!1,r.value=0}}},A=()=>{t.value=null,u.value=null,h("update:modelValue",null),x.value&&(x.value.value="")};return(n,l)=>(i(),a("div",G,[e("label",H,m(_.label),1),t.value?(i(),a("div",Z,[e("div",ee,[e("div",te,[e("div",oe,[l[5]||(l[5]=e("div",{class:"text-green-600 mr-2"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M2 6a2 2 0 012-2h6l2 2h6a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"}),e("path",{stroke:"#fff","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12l2 2 4-4"})])],-1)),e("div",null,[l[4]||(l[4]=e("p",{class:"font-medium text-green-800"}," Video uploaded successfully! ",-1)),e("p",se,m(t.value.name),1)])]),e("button",{onClick:A,class:"text-red-600 hover:text-red-700"},l[6]||(l[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)]))])]),t.value.url?(i(),a("video",{key:0,src:t.value.url,controls:"",class:"w-full max-w-md rounded-lg"}," Your browser does not support the video tag. ",8,le)):v("",!0)])):(i(),a("div",R,[e("div",{class:"border-2 border-dashed border-purple-900 rounded-lg p-6 text-center cursor-pointer hover:opacity-80 transition-opacity",onClick:s,onDragover:l[0]||(l[0]=C(()=>{},["prevent"])),onDrop:C(c,["prevent"])},[!u.value&&!b.value?(i(),a("div",K,l[1]||(l[1]=[j('<div class="mx-auto mb-2 w-12 h-12 text-purple-900" data-v-fb4da90c><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-fb4da90c><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" data-v-fb4da90c></path></svg></div><p class="text-gray-600" data-v-fb4da90c> Click to upload a video or drag and drop </p><p class="text-sm text-gray-500 mt-1" data-v-fb4da90c> MP4, WebM, or OGG (max 100MB) </p>',3)]))):u.value&&!b.value?(i(),a("div",W,[e("p",X,m(u.value.name),1),e("p",Y,m(D(u.value.size)),1),e("button",{onClick:C(P,["stop"]),class:"mt-2 px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700"}," Upload Video ")])):b.value?(i(),a("div",J,[l[2]||(l[2]=e("div",{class:"animate-spin mx-auto mb-2 w-8 h-8"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})])],-1)),l[3]||(l[3]=e("p",null,"Uploading video...",-1)),e("div",Q,[e("div",{class:"bg-purple-600 h-2 rounded-full transition-all duration-300",style:T(`width: ${r.value}%`)},null,4)])])):v("",!0)],32),e("input",{type:"file",ref_key:"fileInput",ref:x,accept:"video/*,.mp4,.webm,.ogg",class:"hidden",onChange:p},null,544)]))]))}},ie=U(re,[["__scopeId","data-v-fb4da90c"]]),ae={class:"max-w-3xl mx-auto py-10 sm:px-6 lg:px-8"},de={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},ne={class:"p-6 bg-white border-b border-gray-200"},ue={class:"mb-6"},pe=["value"],ce={key:0,class:"mt-2 text-sm text-red-600"},me={class:"mb-6"},fe={key:0,class:"mt-2 text-sm text-red-600"},ve={class:"mb-6"},be={key:0,class:"mt-2 text-sm text-red-600"},ge={class:"mb-6"},xe={class:"mb-4"},he=["for"],ye=["onUpdate:modelValue","id"],we={class:"mb-4"},_e=["for"],ke=["onChange","id"],Ce={key:0,class:"mt-1 text-sm text-green-600"},Ve={class:"mb-4"},Me={key:0,class:"mt-1 text-sm text-green-600"},$e={key:0,class:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-md"},Fe=["onClick"],Se={class:"flex items-center justify-end pt-6 border-t border-gray-200"},ze=["disabled"],Be={key:0},Ue={key:1},De={__name:"Create",props:{mainCourses:{type:Array,default:()=>[]}},setup(_){const o=I({title:"",description:"",parent_id:"",materials:[{title:"",file:null,video:null}]}),V=()=>{o.materials.push({title:"",file:null,video:null})},h=r=>{o.materials.splice(r,1)},x=(r,t)=>{const s=r.target.files[0];s&&s.type==="application/pdf"?o.materials[t].file=s:(alert("Please upload a valid PDF file."),r.target.value="")},u=(r,t)=>{o.materials[t].video=r,o.materials[t].uploadthing_url=r.url,o.materials[t].uploadthing_key=r.key,o.materials[t].file_name=r.name,o.materials[t].file_size=r.size},b=()=>{const r=new FormData;r.append("title",o.title),r.append("description",o.description),r.append("parent_id",o.parent_id),o.materials.forEach((t,s)=>{r.append(`materials[${s}][title]`,t.title),t.file&&r.append(`materials[${s}][file]`,t.file)}),o.post(route("admin.courses.store"),{data:r,forceFormData:!0,onSuccess:()=>{o.reset()}})};return(r,t)=>(i(),O(E,{title:"Add Sub-Course"},{default:L(()=>[e("div",ae,[e("div",de,[e("div",ne,[t[14]||(t[14]=e("h2",{class:"text-lg font-medium text-gray-900 mb-6"}," Add Sub-Course ",-1)),e("form",{onSubmit:C(b,["prevent"])},[e("div",ue,[t[5]||(t[5]=e("label",{for:"parent_id",class:"block text-sm font-medium text-gray-700"},"Select Main Course *",-1)),k(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>d(o).parent_id=s),id:"parent_id",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 sm:text-sm",required:""},[t[4]||(t[4]=e("option",{value:""},"Choose a main course",-1)),(i(!0),a(S,null,z(_.mainCourses,s=>(i(),a("option",{key:s.id,value:s.id},m(s.title),9,pe))),128))],512),[[N,d(o).parent_id]]),t[6]||(t[6]=e("p",{class:"mt-1 text-xs text-gray-500"}," Select the main course to which you want to add this sub-course. ",-1)),d(o).errors.parent_id?(i(),a("p",ce,m(d(o).errors.parent_id),1)):v("",!0)]),e("div",me,[t[7]||(t[7]=e("label",{for:"title",class:"block text-sm font-medium text-gray-700"},"Sub-Course Title",-1)),k(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>d(o).title=s),type:"text",id:"title",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 sm:text-sm",required:""},null,512),[[$,d(o).title]]),d(o).errors.title?(i(),a("p",fe,m(d(o).errors.title),1)):v("",!0)]),e("div",ve,[t[8]||(t[8]=e("label",{for:"description",class:"block text-sm font-medium text-gray-700"},"Description",-1)),k(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=s=>d(o).description=s),id:"description",rows:"4",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 sm:text-sm",required:""},null,512),[[$,d(o).description]]),d(o).errors.description?(i(),a("p",be,m(d(o).errors.description),1)):v("",!0)]),e("div",ge,[t[12]||(t[12]=e("h3",{class:"text-md font-medium text-gray-700 mb-4"}," Study Materials ",-1)),(i(!0),a(S,null,z(d(o).materials,(s,p)=>(i(),a("div",{key:p,class:"material-item mb-6 p-4 border rounded-lg"},[e("div",xe,[e("label",{for:`material-title-${p}`,class:"block text-sm font-medium text-gray-700 mb-1"},"Material Title",8,he),k(e("input",{"onUpdate:modelValue":c=>s.title=c,type:"text",id:`material-title-${p}`,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 sm:text-sm",required:""},null,8,ye),[[$,s.title]])]),e("div",we,[e("label",{for:`material-file-${p}`,class:"block text-sm font-medium text-gray-700 mb-1"},"PDF Document (Optional)",8,_e),e("input",{type:"file",onChange:c=>x(c,p),id:`material-file-${p}`,class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100",accept:".pdf"},null,40,ke),t[9]||(t[9]=e("p",{class:"mt-1 text-xs text-gray-500"}," Maximum file size: 10MB. Only PDF files are accepted. ",-1)),s.file?(i(),a("p",Ce," ✓ PDF uploaded: "+m(s.file.name),1)):v("",!0)]),e("div",Ve,[q(ie,{label:`Video for ${s.title||"Material "+(p+1)} (Optional)`,modelValue:s.video,"onUpdate:modelValue":c=>s.video=c,onVideoUploaded:c=>u(c,p)},null,8,["label","modelValue","onUpdate:modelValue","onVideoUploaded"]),s.video?(i(),a("p",Me," ✓ Video uploaded: "+m(s.video.name),1)):v("",!0)]),!s.file&&!s.video?(i(),a("div",$e,t[10]||(t[10]=[e("p",{class:"text-amber-800 text-sm"}," ⚠️ Please upload at least one file (PDF or Video) for this material. ",-1)]))):v("",!0),d(o).materials.length>1?(i(),a("button",{key:1,type:"button",onClick:c=>h(p),class:"inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded text-red-700 bg-red-100 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"}," Remove Material ",8,Fe)):v("",!0)]))),128)),e("button",{type:"button",onClick:V,class:"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-purple-700 bg-purple-100 hover:bg-purple-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500"},t[11]||(t[11]=[e("svg",{class:"-ml-0.5 mr-1.5 h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),B(" Add Another Material ")]))]),e("div",Se,[e("button",{type:"button",onClick:t[3]||(t[3]=s=>r.$inertia.visit(r.route("admin.courses.index"))),class:"mr-4 inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500"}," Cancel "),e("button",{type:"submit",class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500",disabled:d(o).processing},[d(o).processing?(i(),a("span",Be,t[13]||(t[13]=[e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),B(" Saving... ")]))):(i(),a("span",Ue,"Add Sub-Course"))],8,ze)])],32)])])])]),_:1}))}},Ge=U(De,[["__scopeId","data-v-ff1b0771"]]);export{Ge as default};
