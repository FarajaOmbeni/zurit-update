import{C as V,c as C,o as i,w as D,a as t,b as n,f as u,u as l,t as c,g as U,j as f,v as b,F as g,i as x,l as $,d as E,h as _,W as M}from"./app-DsD-n4JU.js";import{_ as S}from"./AdminSidebar-BNeyV2f_.js";import{V as F}from"./VideoUploader-DkQk-s-E.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./EllipsisHorizontalIcon-CeLqe4vC.js";import"./ChartBarIcon-DTGHqwaO.js";import"./UserIcon-CimjXTqK.js";import"./CalendarIcon-6aWZzBAR.js";import"./CalendarDaysIcon-BLxSeDbr.js";import"./DocumentTextIcon-B-GH7_Ie.js";import"./UserGroupIcon-10VTKdZh.js";import"./UsersIcon-Dx62i7zO.js";const B={class:"max-w-3xl mx-auto py-10 sm:px-6 lg:px-8"},O={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},j={class:"p-6 bg-white border-b border-gray-200"},z={key:0,class:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md"},A={class:"flex items-center"},N={class:"text-red-700 text-sm mt-1"},T={class:"mb-6"},q={key:0,class:"mt-2 text-sm text-red-600"},H={key:0,class:"mb-6"},I={key:0,class:"mt-2 text-sm text-red-600"},L={key:1,class:"mb-6"},W=["value","disabled"],R={key:0,class:"mt-2 text-sm text-red-600"},G={key:2,class:"mb-6"},J={class:"mb-4"},K=["for"],Q=["onUpdate:modelValue","id"],X={class:"mb-4"},Y=["for"],Z=["onChange","id"],ee={key:0,class:"mt-1 text-sm text-gray-600"},te={key:1,class:"mt-1 text-sm text-green-600"},se={class:"mb-4"},re={key:0,class:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-md"},oe=["onClick"],ie={class:"flex items-center justify-end pt-6 border-t border-gray-200"},le=["disabled"],de={key:0},ne={key:1},ae={__name:"Edit",props:{course:Object,mainCourses:{type:Array,default:()=>[]}},setup(m){const d=m,r=V({title:d.course.title,description:d.course.parent_id&&d.course.description||"",parent_id:d.course.parent_id&&d.course.parent_id||"",materials:d.course.parent_id&&d.course.materials&&d.course.materials.length>0?d.course.materials.map(o=>({id:o.id,title:o.title,file:null,video_file:null,existing_file:o.file_name})):d.course.parent_id?[{title:"",file:null,video_file:null,existing_file:null}]:[]}),v=()=>{d.course.parent_id&&r.materials.push({title:"",file:null,video_file:null,existing_file:null})},y=o=>{d.course.parent_id&&r.materials.splice(o,1)},h=(o,e)=>{const s=o.target.files[0];s&&s.type==="application/pdf"?r.materials[e].file=s:(alert("Please upload a valid PDF file."),o.target.value="")},w=(o,e)=>{r.materials[e].video_file=o},k=()=>{if(console.log("Submit function called",{courseId:d.course.id,isSubcourse:!!d.course.parent_id,formData:{title:r.title,description:r.description,materials:r.materials}}),!d.course.parent_id)r.put(route("admin.courses.update",{course:d.course.id}),{preserveScroll:!0,onSuccess:()=>{},onError:o=>{console.error("Update errors:",o)}});else{const o=new FormData;o.append("title",r.title),o.append("description",r.description),o.append("parent_id",r.parent_id||""),r.materials.forEach((e,s)=>{o.append(`materials[${s}][title]`,e.title),e.id&&o.append(`materials[${s}][id]`,e.id),e.existing_file&&o.append(`materials[${s}][existing_file]`,e.existing_file),e.file&&o.append(`materials[${s}][file]`,e.file),e.video_file&&o.append(`materials[${s}][video_file]`,e.video_file)}),o.append("_method","PUT"),M.post(route("admin.subcourses.update",{subcourse:d.course.id}),o,{forceFormData:!0,preserveScroll:!0,onBefore:()=>{r.processing=!0},onFinish:()=>{r.processing=!1},onSuccess:e=>{console.log("Update successful",e),e.props.flash&&e.props.flash.success&&alert(e.props.flash.success)},onError:e=>{console.error("Update errors:",e),r.clearErrors(),Object.keys(e).forEach(a=>{r.setError(a,e[a])});const s=Object.values(e)[0];s&&alert("Error: "+(Array.isArray(s)?s[0]:s))}})}};return(o,e)=>(i(),C(S,{title:`Edit ${m.course.title}`},{default:D(()=>[t("div",B,[t("div",O,[t("div",j,[e[16]||(e[16]=t("h2",{class:"text-lg font-medium text-gray-900 mb-6"}," Edit Course ",-1)),l(r).errors.error?(i(),n("div",z,[t("div",A,[e[5]||(e[5]=t("div",{class:"text-red-600 mr-2"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})])],-1)),t("div",null,[e[4]||(e[4]=t("p",{class:"text-red-800 font-medium"}," Upload Error ",-1)),t("p",N,c(l(r).errors.error),1)])])])):u("",!0),t("form",{onSubmit:U(k,["prevent"])},[t("div",T,[e[6]||(e[6]=t("label",{for:"title",class:"block text-sm font-medium text-gray-700"},"Title",-1)),f(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>l(r).title=s),type:"text",id:"title",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 sm:text-sm",required:""},null,512),[[b,l(r).title]]),l(r).errors.title?(i(),n("p",q,c(l(r).errors.title),1)):u("",!0)]),m.course.parent_id?(i(),n("div",H,[e[7]||(e[7]=t("label",{for:"description",class:"block text-sm font-medium text-gray-700"},"Description",-1)),f(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=s=>l(r).description=s),id:"description",rows:"4",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 sm:text-sm",required:""},null,512),[[b,l(r).description]]),l(r).errors.description?(i(),n("p",I,c(l(r).errors.description),1)):u("",!0)])):u("",!0),m.course.parent_id?(i(),n("div",L,[e[9]||(e[9]=t("label",{for:"parent_id",class:"block text_sm font-medium text-gray-700"},"Parent Course (Optional)",-1)),f(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>l(r).parent_id=s),id:"parent_id",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 sm:text-sm"},[e[8]||(e[8]=t("option",{value:""}," Select a main course (or leave empty to make this a main course) ",-1)),(i(!0),n(g,null,x(m.mainCourses,s=>(i(),n("option",{key:s.id,value:s.id,disabled:s.id===m.course.id},c(s.title),9,W))),128))],512),[[$,l(r).parent_id]]),e[10]||(e[10]=t("p",{class:"mt-1 text-xs text-gray-500"}," Leave empty to make this a main course, or select a main course to make this a sub-course. ",-1)),l(r).errors.parent_id?(i(),n("p",R,c(l(r).errors.parent_id),1)):u("",!0)])):u("",!0),m.course.parent_id?(i(),n("div",G,[e[14]||(e[14]=t("h3",{class:"text-md font-medium text-gray-700 mb-4"}," Study Materials ",-1)),(i(!0),n(g,null,x(l(r).materials,(s,a)=>(i(),n("div",{key:a,class:"material-item mb-4 p-4 border rounded-lg"},[t("div",J,[t("label",{for:`material-title-${a}`,class:"block text-sm font-medium text-gray-700 mb-1"},"Document Title",8,K),f(t("input",{"onUpdate:modelValue":p=>s.title=p,type:"text",id:`material-title-${a}`,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 sm:text-sm",required:""},null,8,Q),[[b,s.title]])]),t("div",X,[t("label",{for:`material-file-${a}`,class:"block text-sm font-medium text-gray-700 mb-1"},"PDF Document (Optional)",8,Y),t("input",{type:"file",onChange:p=>h(p,a),id:`material-file-${a}`,class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100",accept:".pdf"},null,40,Z),s.existing_file?(i(),n("p",ee," Current PDF: "+c(s.existing_file),1)):u("",!0),e[11]||(e[11]=t("p",{class:"mt-1 text-xs text-gray-500"}," Maximum file size: 10MB. Only PDF files are accepted. ",-1)),s.file?(i(),n("p",te," ✓ New PDF selected: "+c(s.file.name),1)):u("",!0)]),t("div",se,[E(F,{label:`Video for ${s.title||"Material "+(a+1)} (Optional)`,modelValue:s.video_file,"onUpdate:modelValue":p=>s.video_file=p,onVideoSelected:p=>w(p,a)},null,8,["label","modelValue","onUpdate:modelValue","onVideoSelected"])]),!s.file&&!s.video_file&&!s.existing_file?(i(),n("div",re,e[12]||(e[12]=[t("p",{class:"text-amber-800 text-sm"}," ⚠️ Please upload at least one file (PDF or Video) for this material. ",-1)]))):u("",!0),l(r).materials.length>1?(i(),n("button",{key:1,type:"button",onClick:p=>y(a),class:"inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded text-red-700 bg-red-100 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"}," Remove Material ",8,oe)):u("",!0)]))),128)),t("button",{type:"button",onClick:v,class:"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-purple-700 bg-purple-100 hover:bg-purple-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500"},e[13]||(e[13]=[t("svg",{class:"-ml-0.5 mr-1.5 h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),_(" Add Another Material ")]))])):u("",!0),t("div",ie,[t("button",{type:"button",onClick:e[3]||(e[3]=s=>o.$inertia.visit(o.route("admin.courses.index"))),class:"mr-4 inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500"}," Cancel "),t("button",{type:"submit",class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500",disabled:l(r).processing},[l(r).processing?(i(),n("span",de,e[15]||(e[15]=[t("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),_(" Updating... ")]))):(i(),n("span",ne,"Update Course"))],8,le)])],32)])])])]),_:1},8,["title"]))}},we=P(ae,[["__scopeId","data-v-ca87ac55"]]);export{we as default};
