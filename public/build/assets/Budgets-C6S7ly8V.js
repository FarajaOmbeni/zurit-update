import{r as k,p as x,n as ot,l as W,b as f,o as u,d as D,u as a,a as t,C as nt,m as at,w as K,c as P,f as S,q as E,t as y,E as z,z as L,F as $,s as U,G as lt,g as rt,v as B}from"./app-ChojW93i.js";import{A as it}from"./AuthenticatedLayout-Bbvm2Xi5.js";import{_ as ut}from"./Sidebar-CEcY1Y2w.js";import{u as dt,_ as R}from"./useAlert-ejfo9q2f.js";import{_ as G}from"./BudgetBarChart-z4nM_1Eo.js";import{f as ct}from"./useDateFormat-pjOuPPEs.js";import{C as mt,p as pt,a as gt,b as ft,c as yt,d as bt,L as ht,B as xt}from"./index-DLcddnBA.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                */import"./ChartBarIcon-XeGBJvZX.js";import"./useFormatCurrency-DPZVhC5N.js";const vt={class:"p-4 bg-white shadow rounded-lg"},_t={key:0,style:{height:"400px"}},wt={key:1,class:"text-center text-gray-500 py-10"},St={__name:"IncomeExpenseTrendChart",props:{transactions:{type:Array,default:()=>[]},currentReferenceDate:{type:String,default:()=>new Date().toISOString().split("T")[0]}},setup(I){mt.register(pt,gt,ft,yt,bt,ht);const d=I,h=k(null),_=k({labels:[],datasets:[]});function b(r){return`${["January","February","March","April","May","June","July","August","September","October","November","December"][r.getMonth()]} ${r.getFullYear()}`}const T=x(()=>{const r=new Date(d.currentReferenceDate),l={},w=[];for(let g=5;g>=0;g--){const m=new Date(r);m.setMonth(r.getMonth()-g),m.setDate(1);const v=b(m);w.push(v),l[v]={income:0,expense:0}}(d.transactions||[]).forEach(g=>{if(!g.transaction_date||!g.amount)return;const m=new Date(g.transaction_date),v=b(m);if(l.hasOwnProperty(v)){const C=parseFloat(g.amount);g.type==="income"?l[v].income+=C:l[v].expense+=C}});const c=w.map(g=>{var m;return Math.round(((m=l[g])==null?void 0:m.income)||0)}),A=w.map(g=>{var m;return Math.round(((m=l[g])==null?void 0:m.expense)||0)});return{labels:w,datasets:[{label:"Income",backgroundColor:"rgba(75, 192, 192, 0.5)",borderColor:"rgb(75, 192, 192)",borderWidth:1,data:c},{label:"Expenses",backgroundColor:"rgba(255, 99, 132, 0.5)",borderColor:"rgb(255, 99, 132)",borderWidth:1,data:A}]}}),O=k({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!0,text:"Income vs Expenses (Last 6 Months)",font:{size:16}},tooltip:{callbacks:{label:function(r){let l=r.dataset.label||"";return l&&(l+=": "),r.parsed.y!==null&&(l+=new Intl.NumberFormat("en-US",{style:"currency",currency:"KES"}).format(r.parsed.y)),l}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(r){return"KES "+r.toLocaleString()}}},x:{title:{display:!0,text:"Month"}}}});return ot(T,r=>{_.value=r},{deep:!0}),W(()=>{_.value=T.value}),(r,l)=>(u(),f("div",vt,[I.transactions&&I.transactions.length>0?(u(),f("div",_t,[D(a(xt),{data:_.value,options:O.value,ref_key:"chartRef",ref:h},null,8,["data","options"])])):(u(),f("div",wt,l[0]||(l[0]=[t("p",null,"No transaction data available to display the trend.",-1)])))]))}},kt={class:"w-full text-gray-900"},Mt={class:"py-6"},Et={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},Dt={class:"flex justify-between"},At={class:"text-2xl font-semibold text-gray-900"},Ct={key:2,class:"mt-6 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-3"},It={class:"bg-white overflow-hidden shadow rounded-lg"},Tt={class:"px-4 py-5 sm:p-6"},Nt={class:"mt-1 text-3xl font-semibold text-green-600"},Ot={class:"bg-white overflow-hidden shadow rounded-lg"},Ft={class:"px-4 py-5 sm:p-6"},Bt={class:"mt-1 text-3xl font-semibold text-red-500"},Lt={class:"bg-white overflow-hidden shadow rounded-lg"},$t={class:"px-4 py-5 sm:p-6"},jt={class:"my-4 w-[50%] flex flex-col items-center justify-center mx-auto"},Jt=["value"],Vt={key:3,class:"mt-8 grid grid-cols-1 gap-8 lg:grid-cols-2"},Yt={key:4,class:"mt-8"},Kt={class:"mt-12"},Pt={class:"text-xl font-bold text-center text-gray-900"},zt={class:"mt-4 bg-white shadow rounded-lg"},Ut={class:"divide-y divide-gray-200"},Rt={key:0,class:"px-4 py-6 text-center text-gray-500"},Gt={class:"flex items-center justify-between"},Wt={class:"text-sm font-medium text-gray-900"},qt={class:"text-sm text-gray-500"},Zt={class:"flex flex-col gap-2 md:flex-row md:gap-0 text-sm items-center space-x-2"},Ht=["onClick"],Qt={class:"px-4 py-3 bg-gray-50 border-t border-gray-200"},Xt={class:"flex justify-between items-center"},te={class:"text-sm font-medium text-gray-700"},ee={class:"text-right"},se={class:"text-sm font-medium text-green-600"},oe={class:"text-sm font-medium text-red-600"},ne={key:5,class:"fixed inset-0 z-50 flex items-center justify-center"},ae={class:"relative z-10 w-full max-w-md rounded-lg bg-white p-6 shadow-lg"},le={class:"text-lg font-semibold text-gray-900 mb-4"},re={class:"mt-6 flex justify-end gap-3"},ie=["disabled"],ue={key:0},de={key:1},we={__name:"Budgets",props:{data:Object,today:String},setup(I){const d=I,h=k(null),_=k([]),{alertState:b,openAlert:T,clearAlert:O}=dt(),r=k(!1),l=k(null),w=k(!1),c=nt({category:"",description:"",amount:"",transaction_date:""}),A=x(()=>h.value?(d.data.transactions||[]).filter(s=>{const e=new Date(s.transaction_date);return j(e)===h.value}):[]),g=x(()=>A.value.filter(s=>s.type==="income")),m=x(()=>A.value.filter(s=>s.type!=="income")),v=x(()=>g.value.reduce((s,e)=>s+parseFloat(e.amount),0)),C=x(()=>m.value.reduce((s,e)=>s+parseFloat(e.amount),0)),F=x(()=>v.value-C.value),q=x(()=>{const o=g.value.reduce((i,n)=>{const p=n.category;return i[p]||(i[p]={totalAmount:0,incomes:[]}),i[p].totalAmount+=parseFloat(n.amount),i[p].incomes.push(n),i},{});return Object.entries(o).map(([i,{totalAmount:n}])=>({label:i,amount:Math.round(n)})).sort((i,n)=>n.amount-i.amount).slice(0,3)}),Z=x(()=>{const o=m.value.reduce((n,p)=>{const M=p.category;return n[M]||(n[M]=[]),n[M].push(p),n},{});return Object.entries(o).map(([n,p])=>({category:n,totalAmount:p.reduce((M,st)=>M+parseFloat(st.amount),0),expenses:p})).sort((n,p)=>p.totalAmount-n.totalAmount).slice(0,3).map(n=>({label:n.category,amount:Math.round(n.totalAmount),expenses:n.expenses}))});x(()=>!m.value||m.value.length===0?{}:m.value.reduce((s,e)=>{const o=e.category;return s[o]||(s[o]=0),s[o]+=parseFloat(e.amount),s},{}));const N=x(()=>d.data&&(d.data.incomes&&d.data.incomes.length||d.data.expenses&&d.data.expenses.length||d.data.goals&&d.data.goals.length||d.data.debts&&d.data.debts.length||d.data.investments&&d.data.investments.length));W(()=>{H()});function H(){const s={};(d.data.transactions||[]).forEach(e=>{if(e.transaction_date){const o=new Date(e.transaction_date);if(isNaN(o.getTime()))console.warn("Invalid transaction_date:",e.transaction_date);else{const i=j(o);s[i]=!0}}}),_.value=Object.keys(s).sort((e,o)=>{const[i,n]=e.split(" "),[p,M]=o.split(" ");return parseInt(M)-parseInt(n)||J(p)-J(i)}),_.value.length>0&&V(_.value[0])}function j(s){return`${["January","February","March","April","May","June","July","August","September","October","November","December"][s.getMonth()]} ${s.getFullYear()}`}function J(s){return["January","February","March","April","May","June","July","August","September","October","November","December"].indexOf(s.split(" ")[0])}function V(s){h.value=s}function Q(s){if(!s)return null;const[e,o]=s.split(" "),n=["January","February","March","April","May","June","July","August","September","October","November","December"].indexOf(e),p=parseInt(o,10);return n===-1||isNaN(p)?null:new Date(p,n,1)}const X=x(()=>{const s=Q(h.value);if(!s)return!1;const e=new Date,o=new Date(e.getFullYear(),e.getMonth(),1);return s<o});function tt(s){l.value=s,w.value=s.type==="income",c.category=s.category||"",c.description=s.description||"",c.amount=s.amount??"";const e=s.transaction_date?new Date(s.transaction_date):new Date;c.transaction_date=isNaN(e.getTime())?"":e.toISOString().slice(0,10),r.value=!0}function Y(){r.value=!1,l.value=null}function et(){if(!l.value)return;const s=w.value?"income.past.edit":"expense.past.edit";c.put(route(s,l.value.id),{onSuccess:()=>{r.value=!1,T("success","Transaction updated successfully",5e3),window.location.reload()},onError:e=>{const o=Object.values(e||{}).flat().join(" ")||"Failed to update transaction";T("danger",o,5e3)}})}return(s,e)=>(u(),f($,null,[D(a(at),{title:"Budgets"}),D(it,null,{default:K(()=>[t("div",kt,[D(ut,null,{default:K(()=>[t("div",Mt,[t("div",Et,[a(b)?(u(),P(R,{key:0,type:a(b).type,message:a(b).message,duration:a(b).duration,"auto-close":a(b).autoClose,onClose:a(O)},null,8,["type","message","duration","auto-close","onClose"])):S("",!0),E(t("div",Dt,[t("div",null,[t("h1",At,y(h.value)+"'s Budget",1)])],512),[[z,N.value]]),a(b)?(u(),P(R,{key:1,type:a(b).type,message:a(b).message,duration:a(b).duration,"auto-close":a(b).autoClose,onClose:a(O)},null,8,["type","message","duration","auto-close","onClose"])):S("",!0),N.value?(u(),f("div",Ct,[t("div",It,[t("div",Tt,[e[6]||(e[6]=t("dt",{class:"text-sm font-medium text-gray-500 truncate"},"Total Income",-1)),t("dd",Nt,"KES "+y(v.value.toLocaleString()),1)])]),t("div",Ot,[t("div",Ft,[e[7]||(e[7]=t("dt",{class:"text-sm font-medium text-gray-500 truncate"},"Total Expenses",-1)),t("dd",Bt,"KES "+y(C.value.toLocaleString()),1)])]),t("div",Lt,[t("div",$t,[e[8]||(e[8]=t("dt",{class:"text-sm font-medium text-gray-500 truncate"},"Balance",-1)),t("dd",{class:L(["mt-1 text-3xl font-semibold",F.value>=0?"text-green-600":"text-red-600"])}," KES "+y(F.value.toLocaleString()),3)])])])):S("",!0),t("div",jt,[e[9]||(e[9]=t("label",{for:"monthSelect",class:"block text-sm font-medium text-gray-700 mb-1"},"Select Month",-1)),E(t("select",{id:"monthSelect","onUpdate:modelValue":e[0]||(e[0]=o=>h.value=o),onChange:e[1]||(e[1]=o=>V(h.value)),class:"block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"},[(u(!0),f($,null,U(_.value,(o,i)=>(u(),f("option",{key:i,value:o},y(o),9,Jt))),128))],544),[[lt,h.value]])]),N.value?(u(),f("div",Vt,[D(G,{title:"Top Income Sources",items:q.value,type:"income",class:"bg-white shadow rounded-lg"},null,8,["items"]),D(G,{title:"Top Expenses",items:Z.value,type:"expense",class:"bg-white shadow rounded-lg"},null,8,["items"])])):S("",!0),N.value?(u(),f("div",Yt,[D(St,{transactions:d.data.transactions},null,8,["transactions"])])):S("",!0),E(t("div",Kt,[t("h2",Pt,"All Transactions - "+y(h.value),1),t("div",zt,[t("ul",Ut,[A.value.length===0?(u(),f("li",Rt," No transactions right now. Add the first transaction. ")):S("",!0),(u(!0),f($,null,U(A.value,o=>(u(),f("li",{key:o.id,class:"px-4 py-3"},[t("div",Gt,[t("div",null,[t("p",Wt,y(o.description),1),t("p",qt,y(a(ct)(o.transaction_date)),1)]),t("div",Zt,[t("div",{class:L([o.type==="income"?"text-green-600":"text-red-600","font-medium"])},y(o.type==="income"?"+":"-")+" KES "+y(Math.round(o.amount).toLocaleString()),3),X.value?(u(),f("button",{key:0,type:"button",onClick:i=>tt(o),class:"ml-3 inline-flex items-center rounded-md bg-blue-600 px-3 py-1 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600"}," Edit ",8,Ht)):S("",!0)])])]))),128))]),t("div",Qt,[t("div",Xt,[t("span",te,y(h.value)+" Summary:",1),t("div",ee,[t("p",se,"Income: KES "+y(v.value.toLocaleString()),1),t("p",oe,"Expenses: KES "+y(C.value.toLocaleString()),1),t("p",{class:L(["text-sm font-bold",F.value>=0?"text-green-600":"text-red-600"])}," Balance: KES "+y(F.value.toLocaleString()),3)])])])])],512),[[z,N.value]]),r.value?(u(),f("div",ne,[t("div",{class:"absolute inset-0 bg-black/50",onClick:Y}),t("div",ae,[t("h3",le,"Edit "+y(w.value?"Income":"Expense")+" (Past Month)",1),t("form",{onSubmit:rt(et,["prevent"]),class:"space-y-4"},[t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700"},"Category",-1)),E(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>a(c).category=o),type:"text",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"},null,512),[[B,a(c).category]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700"},"Description",-1)),E(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>a(c).description=o),type:"text",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"},null,512),[[B,a(c).description]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700"},"Amount",-1)),E(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>a(c).amount=o),type:"number",step:"0.01",min:"0",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"},null,512),[[B,a(c).amount]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700"},"Date",-1)),E(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>a(c).transaction_date=o),type:"date",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"},null,512),[[B,a(c).transaction_date]])]),t("div",re,[t("button",{type:"button",onClick:Y,class:"inline-flex items-center rounded-md bg-gray-100 px-4 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-200"},"Cancel"),t("button",{type:"submit",class:"inline-flex items-center rounded-md bg-blue-600 px-4 py-2 text-sm font-semibold text-white hover:bg-blue-700",disabled:a(c).processing},[a(c).processing?(u(),f("span",ue,"Saving...")):(u(),f("span",de,"Save"))],8,ie)])],32)])])):S("",!0)])])]),_:1})])]),_:1})],64))}};export{we as default};
