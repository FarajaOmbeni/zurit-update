import{r as c,z as k,B as _,b as l,o,d as p,a as e,u as P,m as j,f,n as b,t as g,F as I,V as S}from"./app-DLhyxld7.js";import{N as M,_ as N}from"./Footer-Bbo2yTSK.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const B={class:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8 mt-20"},C={class:"max-w-2xl mx-auto"},T={class:"bg-white rounded-lg shadow-lg p-6"},E={class:"border border-gray-200 rounded-lg p-6 mb-6"},L={class:"flex items-center justify-center mb-4"},V={key:0,class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"},$={key:1,class:"flex items-center justify-center w-12 h-12 bg-green-100 rounded-full"},q={key:2,class:"flex items-center justify-center w-12 h-12 bg-red-100 rounded-full"},z={class:"font-medium"},F={class:"bg-gray-50 rounded-lg p-4 mb-6"},R={class:"space-y-2 text-sm"},A={class:"flex justify-between"},D={class:"font-medium"},K={class:"flex justify-between"},U={class:"font-medium"},O={class:"flex justify-between"},G={class:"flex justify-center"},H={key:0,class:"mt-6 text-center text-sm text-gray-500"},X={__name:"Processing",props:{payment:{type:Object,required:!0},phone:{type:String,required:!0},redirectTo:{type:String,required:!0}},setup(m){const i=m,s=c(i.payment.status),y=c(i.payment.reason),u=c(!0),r=c(""),n=c("info");let d=null;const x=async()=>{try{const a=await S.get(`/payments/${i.payment.id}/status`);s.value=a.data.status,y.value=a.data.reason,v(),s.value==="succeeded"?(clearInterval(d),window.location.href=i.redirectTo):s.value==="failed"&&(clearInterval(d),u.value=!1)}catch(a){console.error("Error checking payment status:",a),r.value="Error checking payment status. Please refresh the page.",n.value="danger",u.value=!1}},v=()=>{switch(s.value){case"pending":r.value=`STK push sent to ${i.phone}. Please check your phone and enter your M‑Pesa PIN to complete the payment.`,n.value="info";break;case"succeeded":r.value="Payment successful! Redirecting to your course…",n.value="success";break;case"failed":r.value=h(y.value),n.value="danger";break;default:r.value="Processing payment…",n.value="info"}},h=a=>{const t=(a==null?void 0:a.toLowerCase())||"";return t.includes("cancel")?"Payment was cancelled. Please try again.":t.includes("pin")||t.includes("wrong")?"Incorrect PIN. Please try again.":t.includes("insufficient")?"Insufficient funds. Please try again.":t.includes("timeout")?"Payment timed out. Please try again after 2 minutes.":`Payment failed: ${a||"Unknown error"}. Please try again.`},w=()=>{window.location.href="/elearning/courses"};return k(()=>{v(),s.value==="pending"?d=setInterval(x,3e3):u.value=!1}),_(()=>{d&&clearInterval(d)}),(a,t)=>(o(),l(I,null,[p(P(j),{title:"Payment Processing"}),p(M),e("div",B,[e("div",C,[e("div",T,[t[7]||(t[7]=e("h1",{class:"text-2xl font-semibold text-gray-900 mb-6 text-center"},"E‑Learning Payment Processing",-1)),e("div",E,[e("div",L,[u.value?(o(),l("div",V)):s.value==="succeeded"?(o(),l("div",$,t[0]||(t[0]=[e("svg",{class:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)]))):s.value==="failed"?(o(),l("div",q,t[1]||(t[1]=[e("svg",{class:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))):f("",!0)]),e("div",{class:b([{"text-blue-700 bg-blue-50 border-blue-200":n.value==="info","text-green-700 bg-green-50 border-green-200":n.value==="success","text-red-700 bg-red-50 border-red-200":n.value==="danger","text-yellow-700 bg-yellow-50 border-yellow-200":n.value==="warning"},"p-4 rounded-lg border text-center"])},[e("p",z,g(r.value),1)],2)]),e("div",F,[t[5]||(t[5]=e("h3",{class:"font-semibold text-gray-900 mb-2"},"Payment Details",-1)),e("div",R,[e("div",A,[t[2]||(t[2]=e("span",{class:"text-gray-600"},"Phone Number:",-1)),e("span",D,g(m.phone),1)]),e("div",K,[t[3]||(t[3]=e("span",{class:"text-gray-600"},"Amount:",-1)),e("span",U,"KES "+g(m.payment.amount),1)]),e("div",O,[t[4]||(t[4]=e("span",{class:"text-gray-600"},"Status:",-1)),e("span",{class:b(["font-medium capitalize",{"text-blue-600":s.value==="pending","text-green-600":s.value==="succeeded","text-red-600":s.value==="failed"}])},g(s.value),3)])])]),e("div",G,[s.value==="failed"?(o(),l("button",{key:0,onClick:w,class:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"},"Try Again")):f("",!0)]),u.value?(o(),l("div",H,t[6]||(t[6]=[e("p",null,"This page will automatically update when payment is processed.",-1)]))):f("",!0)])])]),p(N)],64))}};export{X as default};
