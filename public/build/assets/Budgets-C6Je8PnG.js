import{r as L,p as x,n as z,l as J,b as u,o as c,d as S,u as N,a as t,W as P,m as R,w as Y,q as A,c as G,f as k,t as n,Q as O,z as F,F as I,s as T,E as U}from"./app-B-GejVOE.js";import{A as W}from"./AuthenticatedLayout-CimAnSyk.js";import{_ as q}from"./Sidebar-D7o-5Ly5.js";import{_ as $}from"./BudgetBarChart-Dy9tfRv5.js";import{f as H}from"./useDateFormat-pjOuPPEs.js";import{C as Q,p as Z,a as X,b as tt,c as et,d as st,L as ot,B as at}from"./index-B8q1ZdZE.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useFormatCurrency-DPZVhC5N.js";const nt={class:"p-4 bg-white shadow rounded-lg"},lt={key:0,style:{height:"400px"}},rt={key:1,class:"text-center text-gray-500 py-10"},it={__name:"IncomeExpenseTrendChart",props:{transactions:{type:Array,default:()=>[]},currentReferenceDate:{type:String,default:()=>new Date().toISOString().split("T")[0]}},setup(M){Q.register(Z,X,tt,et,st,ot);const d=M,g=L(null),v=L({labels:[],datasets:[]});function f(r){return`${["January","February","March","April","May","June","July","August","September","October","November","December"][r.getMonth()]} ${r.getFullYear()}`}const E=x(()=>{const r=new Date(d.currentReferenceDate),l={},_=[];for(let m=5;m>=0;m--){const i=new Date(r);i.setMonth(r.getMonth()-m),i.setDate(1);const y=f(i);_.push(y),l[y]={income:0,expense:0}}(d.transactions||[]).forEach(m=>{if(!m.transaction_date||!m.amount)return;const i=new Date(m.transaction_date),y=f(i);if(l.hasOwnProperty(y)){const D=parseFloat(m.amount);m.type==="income"?l[y].income+=D:l[y].expense+=D}});const C=_.map(m=>{var i;return Math.round(((i=l[m])==null?void 0:i.income)||0)}),B=_.map(m=>{var i;return Math.round(((i=l[m])==null?void 0:i.expense)||0)});return{labels:_,datasets:[{label:"Income",backgroundColor:"rgba(75, 192, 192, 0.5)",borderColor:"rgb(75, 192, 192)",borderWidth:1,data:C},{label:"Expenses",backgroundColor:"rgba(255, 99, 132, 0.5)",borderColor:"rgb(255, 99, 132)",borderWidth:1,data:B}]}}),b=L({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!0,text:"Income vs Expenses (Last 6 Months)",font:{size:16}},tooltip:{callbacks:{label:function(r){let l=r.dataset.label||"";return l&&(l+=": "),r.parsed.y!==null&&(l+=new Intl.NumberFormat("en-US",{style:"currency",currency:"KES"}).format(r.parsed.y)),l}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(r){return"KES "+r.toLocaleString()}}},x:{title:{display:!0,text:"Month"}}}});return z(E,r=>{v.value=r},{deep:!0}),J(()=>{v.value=E.value}),(r,l)=>(c(),u("div",nt,[M.transactions&&M.transactions.length>0?(c(),u("div",lt,[S(N(at),{data:v.value,options:b.value,ref_key:"chartRef",ref:g},null,8,["data","options"])])):(c(),u("div",rt,l[0]||(l[0]=[t("p",null,"No transaction data available to display the trend.",-1)])))]))}},dt={class:"w-full text-gray-900"},ct={class:"py-6"},ut={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},mt={class:"flex justify-between"},pt={class:"text-2xl font-semibold text-gray-900"},ht={key:1,class:"mt-6 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-3"},gt={class:"bg-white overflow-hidden shadow rounded-lg"},xt={class:"px-4 py-5 sm:p-6"},_t={class:"mt-1 text-3xl font-semibold text-green-600"},vt={class:"bg-white overflow-hidden shadow rounded-lg"},yt={class:"px-4 py-5 sm:p-6"},ft={class:"mt-1 text-3xl font-semibold text-red-500"},bt={class:"bg-white overflow-hidden shadow rounded-lg"},wt={class:"px-4 py-5 sm:p-6"},St={class:"my-4 w-[50%] flex flex-col items-center justify-center mx-auto"},Et=["value"],Mt={key:2,class:"mt-8 grid grid-cols-1 gap-8 lg:grid-cols-2"},Dt={key:3,class:"mt-8"},At={class:"mt-12"},kt={class:"text-xl font-bold text-gray-900 text-center"},It={class:"mt-4 bg-white shadow rounded-lg"},Lt={class:"divide-y divide-gray-200"},Ot={class:"flex items-center justify-between"},Tt={class:"text-sm font-medium text-gray-900"},Ct={class:"flex flex-col gap-2 md:flex-row md:gap-0 text-sm items-center space-x-2"},Bt={class:"text-green-600 font-medium"},Ft={class:"px-4 py-3 bg-gray-50"},Nt={class:"flex items-center justify-between"},Kt={class:"text-sm font-bold text-green-600"},jt={class:"mt-12"},Yt={class:"text-xl font-bold text-gray-900 text-center"},$t={class:"mt-4 bg-white shadow rounded-lg"},Jt={class:"divide-y divide-gray-200"},Vt={class:"flex items-center justify-between"},zt={class:"text-sm font-medium text-gray-900"},Pt={class:"flex flex-col gap-2 md:flex-row md:gap-0 text-sm items-center space-x-2"},Rt={class:"text-red-600 font-medium"},Gt={class:"px-4 py-3 bg-gray-50"},Ut={class:"flex items-center justify-between"},Wt={class:"text-sm font-bold text-red-600"},qt={class:"mt-12"},Ht={class:"text-xl font-bold text-center text-gray-900"},Qt={class:"mt-4 bg-white shadow rounded-lg"},Zt={class:"divide-y divide-gray-200"},Xt={key:0,class:"px-4 py-6 text-center text-gray-500"},te={class:"flex items-center justify-between"},ee={class:"text-sm font-medium text-gray-900"},se={class:"text-sm text-gray-500"},oe={class:"flex flex-col gap-2 md:flex-row md:gap-0 text-sm items-center space-x-2"},ae={class:"px-4 py-3 bg-gray-50 border-t border-gray-200"},ne={class:"flex justify-between items-center"},le={class:"text-sm font-medium text-gray-700"},re={class:"text-right"},ie={class:"text-sm font-medium text-green-600"},de={class:"text-sm font-medium text-red-600"},ve={__name:"Budgets",props:{data:Object,today:String},setup(M){const d=M,g=L(null),v=L([]),f=x(()=>g.value?(d.data.transactions||[]).filter(o=>{const e=new Date(o.transaction_date);return D(e)===g.value}):[]),E=x(()=>f.value.filter(o=>o.type==="income")),b=x(()=>f.value.filter(o=>o.type!=="income")),r=x(()=>E.value.reduce((o,e)=>o+parseFloat(e.amount),0)),l=x(()=>b.value.reduce((o,e)=>o+parseFloat(e.amount),0)),_=x(()=>r.value-l.value),C=x(()=>{const p=E.value.reduce((s,a)=>{const h=a.category;return s[h]||(s[h]={totalAmount:0,incomes:[]}),s[h].totalAmount+=parseFloat(a.amount),s[h].incomes.push(a),s},{});return Object.entries(p).map(([s,{totalAmount:a}])=>({label:s,amount:Math.round(a)})).sort((s,a)=>a.amount-s.amount).slice(0,3)}),B=x(()=>{const p=b.value.reduce((a,h)=>{const w=h.category;return a[w]||(a[w]=[]),a[w].push(h),a},{});return Object.entries(p).map(([a,h])=>({category:a,totalAmount:h.reduce((w,V)=>w+parseFloat(V.amount),0),expenses:h})).sort((a,h)=>h.totalAmount-a.totalAmount).slice(0,3).map(a=>({label:a.category,amount:Math.round(a.totalAmount),expenses:a.expenses}))}),m=x(()=>!b.value||b.value.length===0?{}:b.value.reduce((o,e)=>{const p=e.category;return o[p]||(o[p]=0),o[p]+=parseFloat(e.amount),o},{})),i=x(()=>d.data&&(d.data.incomes&&d.data.incomes.length||d.data.expenses&&d.data.expenses.length||d.data.goals&&d.data.goals.length||d.data.debts&&d.data.debts.length||d.data.investments&&d.data.investments.length));J(()=>{y()});function y(){const o={};(d.data.transactions||[]).forEach(e=>{if(e.transaction_date){const p=new Date(e.transaction_date);if(isNaN(p.getTime()))console.warn("Invalid transaction_date:",e.transaction_date);else{const s=D(p);o[s]=!0}}}),v.value=Object.keys(o).sort((e,p)=>{const[s,a]=e.split(" "),[h,w]=p.split(" ");return parseInt(w)-parseInt(a)||K(h)-K(s)}),v.value.length>0&&j(v.value[0])}function D(o){return`${["January","February","March","April","May","June","July","August","September","October","November","December"][o.getMonth()]} ${o.getFullYear()}`}function K(o){return["January","February","March","April","May","June","July","August","September","October","November","December"].indexOf(o.split(" ")[0])}function j(o){g.value=o}return(o,e)=>{const p=P("Alert");return c(),u(I,null,[S(N(R),{title:"Budgets"}),S(W,null,{default:Y(()=>[t("div",dt,[S(q,null,{default:Y(()=>[t("div",ct,[t("div",ut,[A(t("div",mt,[t("div",null,[t("h1",pt,n(g.value)+"'s Budget",1)])],512),[[O,i.value]]),o.alertState?(c(),G(p,{key:0,type:o.alertState.type,message:o.alertState.message,duration:o.alertState.duration,"auto-close":o.alertState.autoClose,onClose:o.clearAlert},null,8,["type","message","duration","auto-close","onClose"])):k("",!0),i.value?(c(),u("div",ht,[t("div",gt,[t("div",xt,[e[2]||(e[2]=t("dt",{class:"text-sm font-medium text-gray-500 truncate"},"Total Income",-1)),t("dd",_t,"KES "+n(r.value.toLocaleString()),1)])]),t("div",vt,[t("div",yt,[e[3]||(e[3]=t("dt",{class:"text-sm font-medium text-gray-500 truncate"},"Total Expenses",-1)),t("dd",ft,"KES "+n(l.value.toLocaleString()),1)])]),t("div",bt,[t("div",wt,[e[4]||(e[4]=t("dt",{class:"text-sm font-medium text-gray-500 truncate"},"Balance",-1)),t("dd",{class:F(["mt-1 text-3xl font-semibold",_.value>=0?"text-green-600":"text-red-600"])}," KES "+n(_.value.toLocaleString()),3)])])])):k("",!0),t("div",St,[e[5]||(e[5]=t("label",{for:"monthSelect",class:"block text-sm font-medium text-gray-700 mb-1"},"Select Month",-1)),A(t("select",{id:"monthSelect","onUpdate:modelValue":e[0]||(e[0]=s=>g.value=s),onChange:e[1]||(e[1]=s=>j(g.value)),class:"block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"},[(c(!0),u(I,null,T(v.value,(s,a)=>(c(),u("option",{key:a,value:s},n(s),9,Et))),128))],544),[[U,g.value]])]),i.value?(c(),u("div",Mt,[S($,{title:"Top Income Sources",items:C.value,type:"income",class:"bg-white shadow rounded-lg"},null,8,["items"]),S($,{title:"Top Expenses",items:B.value,type:"expense",class:"bg-white shadow rounded-lg"},null,8,["items"])])):k("",!0),i.value?(c(),u("div",Dt,[S(it,{transactions:d.data.transactions},null,8,["transactions"])])):k("",!0),A(t("div",At,[t("h2",kt,"Your Income - "+n(g.value),1),t("div",It,[t("ul",Lt,[(c(!0),u(I,null,T(E.value,s=>(c(),u("li",{key:s.id,class:"px-4 py-3"},[t("div",Ot,[t("div",null,[t("p",Tt,n(s.category)+" - "+n(s.description),1)]),t("div",Ct,[t("div",Bt," + KES "+n(Math.round(parseFloat(s.amount)).toLocaleString()),1)])])]))),128)),t("li",Ft,[t("div",Nt,[e[6]||(e[6]=t("div",null,[t("p",{class:"text-sm font-bold text-gray-900"}," TOTAL INCOME ")],-1)),t("div",Kt," KES "+n(r.value.toLocaleString()),1)])])])])],512),[[O,i.value]]),A(t("div",jt,[t("h2",Yt,"Your Budget - "+n(g.value),1),t("div",$t,[t("ul",Jt,[(c(!0),u(I,null,T(m.value,(s,a)=>(c(),u("li",{key:a,class:"px-4 py-3"},[t("div",Vt,[t("div",null,[t("p",zt,n(a),1)]),t("div",Pt,[t("div",Rt," - KES "+n(Math.round(parseFloat(s)).toLocaleString()),1)])])]))),128)),t("li",Gt,[t("div",Ut,[e[7]||(e[7]=t("div",null,[t("p",{class:"text-sm font-bold text-gray-900"}," TOTAL MONTHLY BUDGET ")],-1)),t("div",Wt," KES "+n(l.value.toLocaleString()),1)])])])])],512),[[O,i.value]]),A(t("div",qt,[t("h2",Ht,"All Transactions - "+n(g.value),1),t("div",Qt,[t("ul",Zt,[f.value.length===0?(c(),u("li",Xt," No transactions right now. Add the first transaction. ")):k("",!0),(c(!0),u(I,null,T(f.value,s=>(c(),u("li",{key:s.id,class:"px-4 py-3"},[t("div",te,[t("div",null,[t("p",ee,n(s.description),1),t("p",se,n(N(H)(s.transaction_date)),1)]),t("div",oe,[t("div",{class:F([s.type==="income"?"text-green-600":"text-red-600","font-medium"])},n(s.type==="income"?"+":"-")+" KES "+n(Math.round(s.amount).toLocaleString()),3)])])]))),128))]),t("div",ae,[t("div",ne,[t("span",le,n(g.value)+" Summary:",1),t("div",re,[t("p",ie,"Income: KES "+n(r.value.toLocaleString()),1),t("p",de,"Expenses: KES "+n(l.value.toLocaleString()),1),t("p",{class:F(["text-sm font-bold",_.value>=0?"text-green-600":"text-red-600"])}," Balance: KES "+n(_.value.toLocaleString()),3)])])])])],512),[[O,i.value]])])])]),_:1})])]),_:1})],64)}}};export{ve as default};
