import{r as w,C as st,l as p,y as ot,b as m,o as u,d as b,u as a,m as nt,w as K,a as e,c as P,f as y,j as v,t as d,Q as Y,n as I,F as O,i as U,k as at,g as lt,v as D}from"./app-BrBpuQc2.js";import{A as rt}from"./AuthenticatedLayout-DI0A_a7S.js";import{_ as it}from"./Sidebar-BVcZVhuP.js";import{_ as z}from"./Alert-8uxjqS8u.js";import{u as ut}from"./useAlert-BxUhy8ur.js";import{_ as G}from"./BudgetBarChart-CQOzggLw.js";import{f as dt}from"./useDateFormat-pjOuPPEs.js";import{_ as ct}from"./IncomeExpenseTrendChart-wImTsJQi.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                */import"./EllipsisHorizontalIcon-DjjSpPvf.js";import"./UserIcon-BxWZdp85.js";import"./HomeIcon-BCZWsppc.js";import"./useFormatCurrency-Dh16EV-S.js";import"./index-CpfgmaVl.js";const mt={class:"w-full text-gray-900"},pt={class:"py-6"},gt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},ft={class:"flex justify-between"},yt={class:"text-2xl font-semibold text-gray-900"},xt={key:2,class:"mt-6 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-3"},vt={class:"bg-white overflow-hidden shadow rounded-lg"},bt={class:"px-4 py-5 sm:p-6"},ht={class:"mt-1 text-3xl font-semibold text-green-600"},_t={class:"bg-white overflow-hidden shadow rounded-lg"},wt={class:"px-4 py-5 sm:p-6"},St={class:"mt-1 text-3xl font-semibold text-red-500"},kt={class:"bg-white overflow-hidden shadow rounded-lg"},Et={class:"px-4 py-5 sm:p-6"},Mt={class:"my-4 w-[50%] flex flex-col items-center justify-center mx-auto"},At=["value"],Dt={key:3,class:"mt-8 grid grid-cols-1 gap-8 lg:grid-cols-2"},Tt={key:4,class:"mt-8"},Nt={class:"mt-12"},Ct={class:"text-xl font-bold text-center text-gray-900"},It={class:"mt-4 bg-white shadow rounded-lg"},Ot={class:"divide-y divide-gray-200"},Ft={key:0,class:"px-4 py-6 text-center text-gray-500"},jt={class:"flex items-center justify-between"},Bt={class:"text-sm font-medium text-gray-900"},Jt={class:"text-sm text-gray-500"},Lt={class:"flex flex-col gap-2 md:flex-row md:gap-0 text-sm items-center space-x-2"},Vt=["onClick"],$t={class:"px-4 py-3 bg-gray-50 border-t border-gray-200"},Kt={class:"flex justify-between items-center"},Pt={class:"text-sm font-medium text-gray-700"},Yt={class:"text-right"},Ut={class:"text-sm font-medium text-green-600"},zt={class:"text-sm font-medium text-red-600"},Gt={key:5,class:"fixed inset-0 z-50 flex items-center justify-center"},Qt={class:"relative z-10 w-full max-w-md rounded-lg bg-white p-6 shadow-lg"},qt={class:"text-lg font-semibold text-gray-900 mb-4"},Ht={class:"mt-6 flex justify-end gap-3"},Rt=["disabled"],Wt={key:0},Xt={key:1},ge={__name:"Budgets",props:{data:Object,today:String},setup(Q){const c=Q,g=w(null),S=w([]),{alertState:f,openAlert:F,clearAlert:j}=ut(),k=w(!1),E=w(null),T=w(!1),i=st({category:"",description:"",amount:"",transaction_date:""}),M=p(()=>g.value?(c.data.transactions||[]).filter(s=>{const t=new Date(s.transaction_date);return J(t)===g.value}):[]),B=p(()=>M.value.filter(s=>s.type==="income")),h=p(()=>M.value.filter(s=>s.type!=="income")),N=p(()=>B.value.reduce((s,t)=>s+parseFloat(t.amount),0)),C=p(()=>h.value.reduce((s,t)=>s+parseFloat(t.amount),0)),A=p(()=>N.value-C.value),q=p(()=>{const o=B.value.reduce((l,n)=>{const r=n.category;return l[r]||(l[r]={totalAmount:0,incomes:[]}),l[r].totalAmount+=parseFloat(n.amount),l[r].incomes.push(n),l},{});return Object.entries(o).map(([l,{totalAmount:n}])=>({label:l,amount:Math.round(n)})).sort((l,n)=>n.amount-l.amount).slice(0,3)}),H=p(()=>{const o=h.value.reduce((n,r)=>{const x=r.category;return n[x]||(n[x]=[]),n[x].push(r),n},{});return Object.entries(o).map(([n,r])=>({category:n,totalAmount:r.reduce((x,et)=>x+parseFloat(et.amount),0),expenses:r})).sort((n,r)=>r.totalAmount-n.totalAmount).slice(0,3).map(n=>({label:n.category,amount:Math.round(n.totalAmount),expenses:n.expenses}))});p(()=>!h.value||h.value.length===0?{}:h.value.reduce((s,t)=>{const o=t.category;return s[o]||(s[o]=0),s[o]+=parseFloat(t.amount),s},{}));const _=p(()=>c.data&&(c.data.incomes&&c.data.incomes.length||c.data.expenses&&c.data.expenses.length||c.data.goals&&c.data.goals.length||c.data.debts&&c.data.debts.length||c.data.investments&&c.data.investments.length));ot(()=>{R()});function R(){const s={};(c.data.transactions||[]).forEach(t=>{if(t.transaction_date){const o=new Date(t.transaction_date);if(isNaN(o.getTime()))console.warn("Invalid transaction_date:",t.transaction_date);else{const l=J(o);s[l]=!0}}}),S.value=Object.keys(s).sort((t,o)=>{const[l,n]=t.split(" "),[r,x]=o.split(" ");return parseInt(x)-parseInt(n)||L(r)-L(l)}),S.value.length>0&&V(S.value[0])}function J(s){return`${["January","February","March","April","May","June","July","August","September","October","November","December"][s.getMonth()]} ${s.getFullYear()}`}function L(s){return["January","February","March","April","May","June","July","August","September","October","November","December"].indexOf(s.split(" ")[0])}function V(s){g.value=s}function W(s){if(!s)return null;const[t,o]=s.split(" "),n=["January","February","March","April","May","June","July","August","September","October","November","December"].indexOf(t),r=parseInt(o,10);return n===-1||isNaN(r)?null:new Date(r,n,1)}const X=p(()=>{const s=W(g.value);if(!s)return!1;const t=new Date,o=new Date(t.getFullYear(),t.getMonth(),1);return s<o});function Z(s){E.value=s,T.value=s.type==="income",i.category=s.category||"",i.description=s.description||"",i.amount=s.amount??"";const t=s.transaction_date?new Date(s.transaction_date):new Date;i.transaction_date=isNaN(t.getTime())?"":t.toISOString().slice(0,10),k.value=!0}function $(){k.value=!1,E.value=null}function tt(){if(!E.value)return;const s=T.value?"income.past.edit":"expense.past.edit";i.put(route(s,E.value.id),{onSuccess:()=>{k.value=!1,F("success","Transaction updated successfully",5e3),window.location.reload()},onError:t=>{const o=Object.values(t||{}).flat().join(" ")||"Failed to update transaction";F("danger",o,5e3)}})}return(s,t)=>(u(),m(O,null,[b(a(nt),{title:"Budgets"}),b(rt,null,{default:K(()=>[e("div",mt,[b(it,null,{default:K(()=>[e("div",pt,[e("div",gt,[a(f)?(u(),P(z,{key:0,type:a(f).type,message:a(f).message,duration:a(f).duration,"auto-close":a(f).autoClose,onClose:a(j)},null,8,["type","message","duration","auto-close","onClose"])):y("",!0),v(e("div",ft,[e("div",null,[e("h1",yt,d(g.value)+"'s Budget",1)])],512),[[Y,_.value]]),a(f)?(u(),P(z,{key:1,type:a(f).type,message:a(f).message,duration:a(f).duration,"auto-close":a(f).autoClose,onClose:a(j)},null,8,["type","message","duration","auto-close","onClose"])):y("",!0),_.value?(u(),m("div",xt,[e("div",vt,[e("div",bt,[t[6]||(t[6]=e("dt",{class:"text-sm font-medium text-gray-500 truncate"},"Total Income",-1)),e("dd",ht,"KES "+d(N.value.toLocaleString()),1)])]),e("div",_t,[e("div",wt,[t[7]||(t[7]=e("dt",{class:"text-sm font-medium text-gray-500 truncate"},"Total Expenses",-1)),e("dd",St,"KES "+d(C.value.toLocaleString()),1)])]),e("div",kt,[e("div",Et,[t[8]||(t[8]=e("dt",{class:"text-sm font-medium text-gray-500 truncate"},"Balance",-1)),e("dd",{class:I(["mt-1 text-3xl font-semibold",A.value>=0?"text-green-600":"text-red-600"])}," KES "+d(A.value.toLocaleString()),3)])])])):y("",!0),e("div",Mt,[t[9]||(t[9]=e("label",{for:"monthSelect",class:"block text-sm font-medium text-gray-700 mb-1"},"Select Month",-1)),v(e("select",{id:"monthSelect","onUpdate:modelValue":t[0]||(t[0]=o=>g.value=o),onChange:t[1]||(t[1]=o=>V(g.value)),class:"block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"},[(u(!0),m(O,null,U(S.value,(o,l)=>(u(),m("option",{key:l,value:o},d(o),9,At))),128))],544),[[at,g.value]])]),_.value?(u(),m("div",Dt,[b(G,{title:"Top Income Sources",items:q.value,type:"income",class:"bg-white shadow rounded-lg"},null,8,["items"]),b(G,{title:"Top Expenses",items:H.value,type:"expense",class:"bg-white shadow rounded-lg"},null,8,["items"])])):y("",!0),_.value?(u(),m("div",Tt,[b(ct,{transactions:c.data.transactions},null,8,["transactions"])])):y("",!0),v(e("div",Nt,[e("h2",Ct,"All Transactions - "+d(g.value),1),e("div",It,[e("ul",Ot,[M.value.length===0?(u(),m("li",Ft," No transactions right now. Add the first transaction. ")):y("",!0),(u(!0),m(O,null,U(M.value,o=>(u(),m("li",{key:o.id,class:"px-4 py-3"},[e("div",jt,[e("div",null,[e("p",Bt,d(o.description),1),e("p",Jt,d(a(dt)(o.transaction_date)),1)]),e("div",Lt,[e("div",{class:I([o.type==="income"?"text-green-600":"text-red-600","font-medium"])},d(o.type==="income"?"+":"-")+" KES "+d(Math.round(o.amount).toLocaleString()),3),X.value?(u(),m("button",{key:0,type:"button",onClick:l=>Z(o),class:"ml-3 inline-flex items-center rounded-md bg-blue-600 px-3 py-1 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600"}," Edit ",8,Vt)):y("",!0)])])]))),128))]),e("div",$t,[e("div",Kt,[e("span",Pt,d(g.value)+" Summary:",1),e("div",Yt,[e("p",Ut,"Income: KES "+d(N.value.toLocaleString()),1),e("p",zt,"Expenses: KES "+d(C.value.toLocaleString()),1),e("p",{class:I(["text-sm font-bold",A.value>=0?"text-green-600":"text-red-600"])}," Balance: KES "+d(A.value.toLocaleString()),3)])])])])],512),[[Y,_.value]]),k.value?(u(),m("div",Gt,[e("div",{class:"absolute inset-0 bg-black/50",onClick:$}),e("div",Qt,[e("h3",qt,"Edit "+d(T.value?"Income":"Expense")+" (Past Month)",1),e("form",{onSubmit:lt(tt,["prevent"]),class:"space-y-4"},[e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700"},"Category",-1)),v(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>a(i).category=o),type:"text",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"},null,512),[[D,a(i).category]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700"},"Description",-1)),v(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>a(i).description=o),type:"text",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"},null,512),[[D,a(i).description]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700"},"Amount",-1)),v(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>a(i).amount=o),type:"number",step:"0.01",min:"0",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"},null,512),[[D,a(i).amount]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700"},"Date",-1)),v(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>a(i).transaction_date=o),type:"date",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"},null,512),[[D,a(i).transaction_date]])]),e("div",Ht,[e("button",{type:"button",onClick:$,class:"inline-flex items-center rounded-md bg-gray-100 px-4 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-200"},"Cancel"),e("button",{type:"submit",class:"inline-flex items-center rounded-md bg-blue-600 px-4 py-2 text-sm font-semibold text-white hover:bg-blue-700",disabled:a(i).processing},[a(i).processing?(u(),m("span",Wt,"Saving...")):(u(),m("span",Xt,"Save"))],8,Rt)])],32)])])):y("",!0)])])]),_:1})])]),_:1})],64))}};export{ge as default};
