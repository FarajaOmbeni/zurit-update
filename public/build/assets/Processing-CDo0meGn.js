import{r as y,y as w,B as P,b as l,o as i,d as p,a as e,u as _,m as B,f as g,t as u,n as h,F as S,X as j}from"./app-DGfwjXf9.js";import{N as C,_ as M}from"./Footer-rybiRfPa.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const N={class:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8 mt-20"},T={class:"max-w-2xl mx-auto"},I={class:"bg-white rounded-lg shadow-lg p-6"},$={class:"text-2xl font-semibold text-gray-900 mb-6 text-center"},z={class:"border border-gray-200 rounded-lg p-6 mb-6"},A={class:"flex items-center justify-center mb-4"},E={key:0,class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"},F={key:1,class:"flex items-center justify-center w-12 h-12 bg-green-100 rounded-full"},L={key:2,class:"flex items-center justify-center w-12 h-12 bg-red-100 rounded-full"},q={class:"font-medium"},R={class:"bg-gray-50 rounded-lg p-4 mb-6"},V={class:"space-y-2 text-sm"},Y={class:"flex justify-between"},D={class:"font-medium"},K={class:"flex justify-between"},O={class:"font-medium"},U={key:0,class:"flex justify-between"},Z={class:"font-medium"},G={class:"flex justify-between"},W={class:"flex justify-center space-x-4"},X={key:0,class:"mt-6 text-center text-sm text-gray-500"},ee={__name:"Processing",props:{payment:{type:Object,required:!0},phone:{type:String,required:!0},bookTitle:{type:String,default:null},type:{type:String,required:!0}},setup(r){const n=r,s=y(n.payment.status),b=y(n.payment.reason),c=y(!0),d=y(""),o=y("info");let m=null;const k=async()=>{try{const a=n.type==="book"?`/book/status/${n.payment.id}`:`/user/zuriscore/status/${n.payment.id}`,t=await j.get(a);s.value=t.data.status,b.value=t.data.reason,v(),(s.value==="succeeded"||s.value==="failed")&&(clearInterval(m),c.value=!1)}catch(a){console.error("Error checking payment status:",a),d.value="Error checking payment status. Please refresh the page.",o.value="danger",c.value=!1}},v=()=>{switch(s.value){case"pending":d.value=`STK push sent to ${n.phone}. Please check your phone and enter your M-Pesa PIN to complete the payment.`,o.value="info";break;case"succeeded":n.type==="book"?d.value=`Payment successful! Your book "${n.bookTitle}" order is confirmed. Check your email and spam folder if necessary. 
We will contact you shortly for delivery.`:d.value="Payment successful! Your ZuriScore report is being generated and will be sent to your email shortly.",o.value="success";break;case"failed":d.value=x(b.value),o.value="danger";break;default:d.value="Processing payment...",o.value="info"}},x=a=>{const t=(a==null?void 0:a.toLowerCase())||"";return t.includes("cancel")||t.includes("cancelled")?"Payment was cancelled. You can try again by going back to the form.":t.includes("pin")||t.includes("wrong")?"Payment failed due to incorrect PIN. Please try again.":t.includes("insufficient")?"Payment failed due to insufficient funds. Please ensure you have enough balance and try again.":t.includes("timeout")?"Payment timed out. Please try again after 2 minutes.":`Payment failed: ${a||"Unknown error"}. Please try again.`},f=()=>{n.type==="book"?window.location.href="/books":window.location.href="/user/zuriscore"};return w(()=>{v(),s.value==="pending"?m=setInterval(k,3e3):c.value=!1}),P(()=>{m&&clearInterval(m)}),(a,t)=>(i(),l(S,null,[p(_(B),{title:"Payment Processing"}),p(C),e("div",N,[e("div",T,[e("div",I,[e("h1",$,u(r.type==="book"?"Book Purchase":"ZuriScore Payment")+" Processing ",1),e("div",z,[e("div",A,[c.value?(i(),l("div",E)):s.value==="succeeded"?(i(),l("div",F,t[0]||(t[0]=[e("svg",{class:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)]))):s.value==="failed"?(i(),l("div",L,t[1]||(t[1]=[e("svg",{class:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))):g("",!0)]),e("div",{class:h([{"text-blue-700 bg-blue-50 border-blue-200":o.value==="info","text-green-700 bg-green-50 border-green-200":o.value==="success","text-red-700 bg-red-50 border-red-200":o.value==="danger","text-yellow-700 bg-yellow-50 border-yellow-200":o.value==="warning"},"p-4 rounded-lg border text-center"])},[e("p",q,u(d.value),1)],2)]),e("div",R,[t[6]||(t[6]=e("h3",{class:"font-semibold text-gray-900 mb-2"},"Payment Details",-1)),e("div",V,[e("div",Y,[t[2]||(t[2]=e("span",{class:"text-gray-600"},"Phone Number:",-1)),e("span",D,u(r.phone),1)]),e("div",K,[t[3]||(t[3]=e("span",{class:"text-gray-600"},"Amount:",-1)),e("span",O,"KES "+u(r.payment.amount),1)]),r.bookTitle?(i(),l("div",U,[t[4]||(t[4]=e("span",{class:"text-gray-600"},"Book:",-1)),e("span",Z,u(r.bookTitle),1)])):g("",!0),e("div",G,[t[5]||(t[5]=e("span",{class:"text-gray-600"},"Status:",-1)),e("span",{class:h(["font-medium capitalize",{"text-blue-600":s.value==="pending","text-green-600":s.value==="succeeded","text-red-600":s.value==="failed"}])},u(s.value),3)])])]),e("div",W,[s.value==="failed"?(i(),l("button",{key:0,onClick:f,class:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200"}," Try Again ")):g("",!0),s.value==="succeeded"?(i(),l("button",{key:1,onClick:f,class:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-200"},u(r.type==="book"?"Order Another Book":"Generate Another Report"),1)):g("",!0),e("button",{onClick:f,class:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors duration-200"},u(r.type==="book"?"Back to Books":"Back to Form"),1)]),c.value?(i(),l("div",X,t[7]||(t[7]=[e("p",null,"This page will automatically update when payment is processed.",-1)]))):g("",!0)])])]),p(M)],64))}};export{ee as default};
