import{r as y,C as O,k as F,p as oe,b as d,o as r,d as i,u as o,m as ae,w as N,a as t,f as b,c as ie,t as u,h as g,g as ne,j as re,G as de,F as U,i as P,P as ue,n as ce}from"./app-DsD-n4JU.js";import{A as me}from"./AuthenticatedLayout-xVb4ke35.js";import{_ as fe}from"./Sidebar-B8XwlamX.js";import{_ as pe}from"./DashboardBackButton-CrHd89q8.js";import{_ as ge,r as T,a as ve,b as ye}from"./LegacyProgress-7ZZYZqvP.js";import{_ as h}from"./Input-Dx-lqL61.js";import{_ as I}from"./Select-BrzKX9hX.js";import{_ as be}from"./Alert-uwl6MtLU.js";import{u as xe}from"./useAlert-F0U4ts5N.js";import{r as R}from"./UsersIcon-Dx62i7zO.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                */import"./EllipsisHorizontalIcon-CeLqe4vC.js";import"./AcademicCapIcon-337SsQ9X.js";import"./UserIcon-CimjXTqK.js";import"./ChartBarIcon-DTGHqwaO.js";import"./HomeIcon-DRwSzbYE.js";const _e={class:"w-full text-gray-900"},he={class:"max-w-6xl mx-auto p-6"},we={class:"flex justify-between items-center mb-8"},ke={class:"text-right"},Be={class:"text-2xl font-bold text-green-600"},Ve={class:"mb-6"},Ae={key:1,class:"bg-white rounded-lg shadow-sm border p-6 mb-8"},Ce={class:"text-lg font-semibold text-gray-900 mb-4"},Ee={class:"grid md:grid-cols-2 gap-4"},$e={class:"grid md:grid-cols-2 gap-4"},je={class:"grid md:grid-cols-2 gap-4"},Se={class:"flex items-center space-x-2"},De={class:"flex space-x-4"},Fe=["disabled"],Ne={key:2,class:"space-y-4 mb-8"},Ue={class:"grid gap-4"},qe={class:"flex items-start justify-between"},Me={class:"flex-1"},Oe={class:"flex items-center space-x-3 mb-2"},Pe={class:"text-lg font-semibold text-gray-900"},Te={class:"text-sm text-gray-500"},Ie={class:"text-gray-600 mb-3"},Re={key:0},Le={key:1},Ye={key:2},ze={class:"text-sm text-gray-500"},Ke={class:"flex items-center space-x-2 ml-4"},Ge=["onClick"],Je=["onClick"],He={key:3,class:"text-center py-12"},Qe={key:4,class:"flex justify-end pt-8 border-t"},We={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Xe={class:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4"},Ze={class:"p-6"},et={class:"mb-6"},tt={class:"text-gray-600"},st={class:"flex space-x-4"},lt=["disabled"],ot={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},at={class:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4"},it={class:"p-6"},nt={class:"mb-4"},rt={class:"text-gray-600 text-sm"},dt={class:"grid md:grid-cols-2 gap-4 mb-4"},ut={key:0,class:"text-gray-600 text-sm mb-4"},ct={class:"space-y-3 max-h-80 overflow-y-auto mb-4"},mt={class:"md:col-span-4"},ft={class:"md:col-span-2"},pt={class:"md:col-span-6 flex justify-end"},gt=["onClick"],vt={class:"text-sm text-gray-600 mb-4"},yt={class:"flex space-x-4"},bt=["disabled"],qt={__name:"Beneficiaries",props:{beneficiaries:{type:Array,default:()=>[]},assets:{type:Array,default:()=>[]}},setup(w){const S=w,{openAlert:m,clearAlert:L,alertState:k}=xe(),f=y(!1),p=y(null),A=y(!1),_=y(null),a=O({full_name:"",national_id:"",relationship:"",is_minor:!1,email:"",phone_number:""});function D(){a.reset(),a.clearErrors()}function Y(){p.value?a.put(route("legacy.beneficiaries.update",p.value.id),{onSuccess:()=>{D(),f.value=!1,p.value=null,m("success","Beneficiary updated successfully!",5e3)},onError:s=>{const e=Object.values(s).flat().join(" ");m("danger",e,1e4)}}):a.post(route("legacy.beneficiaries.store"),{onSuccess:()=>{D(),f.value=!1,m("success","Beneficiary added successfully!",5e3)},onError:s=>{const e=Object.values(s).flat().join(" ");m("danger",e,1e4)}})}function z(s){p.value=s,a.full_name=s.full_name,a.national_id=s.national_id||"",a.relationship=s.relationship||"",a.is_minor=!!s.is_minor,a.email=s.email||"",a.phone_number=s.phone_number||"",f.value=!0}function q(){p.value=null,D(),f.value=!1}function K(s){_.value=s,A.value=!0}function G(){_.value&&a.delete(route("legacy.beneficiaries.destroy",_.value.id),{onSuccess:()=>{A.value=!1,_.value=null,m("success","Beneficiary deleted successfully!",5e3)},onError:s=>{const e=Object.values(s).flat().join(" ");m("danger",e,1e4)}})}function J(){A.value=!1,_.value=null}const C=y(!1),E=y(!1),B=y(""),$=y(null),v=y([]),H=F(()=>S.assets.map(s=>({value:s.id,label:s.name}))),Q=F(()=>S.beneficiaries.map(s=>({value:s.id,label:s.full_name}))),j=F(()=>v.value.reduce((s,e)=>s+(parseFloat(e.percentage)||0),0));oe(B,async s=>{C.value&&s&&await W(s)});async function W(s){E.value=!0;try{const e=route("legacy.asset-allocation.status")+`?asset_id=${s}`,n=await fetch(e,{headers:{Accept:"application/json"}});if(!n.ok)throw new Error("Failed to load allocations");const l=((await n.json()).allocations||[]).map(c=>({beneficiary_id:c.beneficiary_id,percentage:c.percentage,conditions:c.conditions||"",contingent_of:c.contingent_of||null}));l.some(c=>c.beneficiary_id===$.value.id)||l.push({beneficiary_id:$.value.id,percentage:0,conditions:"",contingent_of:null}),v.value=l}catch{m("danger","Could not load current allocations. Please try again.",8e3)}finally{E.value=!1}}function X(){v.value.push({beneficiary_id:null,percentage:0,conditions:"",contingent_of:null})}function Z(s){v.value.splice(s,1)}function ee(){const s=v.value.map(n=>n.beneficiary_id).filter(Boolean),e=new Set(s);return s.length!==e.size?(m("danger","Each beneficiary can only appear once per asset.",8e3),!1):j.value>100.01?(m("danger",`Total allocation cannot exceed 100%. Current: ${j.value}%`,8e3),!1):v.value.some(n=>n.beneficiary_id===$.value.id)?(v.value=v.value.filter(n=>n.beneficiary_id!=null),!0):(m("danger","Selected beneficiary must be included in the allocations.",8e3),!1)}function te(){if(!B.value){m("danger","Please select an asset first.",6e3);return}if(!ee())return;const s={asset_id:B.value,beneficiary_allocations:v.value.map(n=>({beneficiary_id:n.beneficiary_id,percentage:Number(n.percentage)||0,conditions:n.conditions||null,contingent_of:n.contingent_of||null}))};O(s).post(route("legacy.asset-allocation.store"),{preserveScroll:!0,onSuccess:()=>{C.value=!1,m("success","Allocations saved successfully!",5e3)},onError:n=>{const V=Object.values(n).flat().join(" ");m("danger",V||"Could not save allocations.",1e4)}})}function se(){return S.assets.reduce((s,e)=>s+parseFloat(e.value||0),0)}function le(s){return new Intl.NumberFormat("en-KE",{style:"currency",currency:"KES",minimumFractionDigits:0}).format(s||0)}return(s,e)=>(r(),d(U,null,[i(o(ae),{title:"Beneficiaries - Legacy & Estate Planning"}),i(me,null,{default:N(()=>{var n,V;return[t("div",_e,[i(fe,null,{default:N(()=>[i(pe),t("div",he,[o(k)?(r(),ie(be,{key:0,type:o(k).type,message:o(k).message,duration:o(k).duration,"auto-close":o(k).autoClose,onClose:o(L)},null,8,["type","message","duration","auto-close","onClose"])):b("",!0),t("div",we,[e[12]||(e[12]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900 mb-2"}," Step 2: Your Beneficiaries "),t("p",{class:"text-gray-600"}," Manage your beneficiaries. ")],-1)),t("div",ke,[e[11]||(e[11]=t("div",{class:"text-sm text-gray-500 mb-1"},"Total Asset Value",-1)),t("div",Be,u(le(se())),1)])]),i(ge,{current:2}),t("div",Ve,[t("button",{onClick:e[0]||(e[0]=l=>f.value?p.value?q():f.value=!1:f.value=!0),class:"bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg flex items-center transition-colors duration-200"},[i(o(T),{class:"w-5 h-5 mr-2"}),g(" "+u(f.value?"Cancel":"Add Beneficiary"),1)])]),f.value?(r(),d("div",Ae,[t("h3",Ce,u(p.value?"Edit Beneficiary":"Add New Beneficiary"),1),t("form",{onSubmit:ne(Y,["prevent"]),class:"space-y-4"},[t("div",Ee,[i(h,{modelValue:o(a).full_name,"onUpdate:modelValue":e[1]||(e[1]=l=>o(a).full_name=l),label:"Full Name",placeholder:"e.g., Jane Doe",error:o(a).errors.full_name,required:""},null,8,["modelValue","error"]),i(h,{modelValue:o(a).national_id,"onUpdate:modelValue":e[2]||(e[2]=l=>o(a).national_id=l),label:o(a).is_minor?"National ID (Optional)":"National ID (Required)",placeholder:"ID Number",error:o(a).errors.national_id,required:!o(a).is_minor},null,8,["modelValue","label","error","required"])]),t("div",$e,[i(h,{modelValue:o(a).relationship,"onUpdate:modelValue":e[3]||(e[3]=l=>o(a).relationship=l),label:"Relationship (Optional)",placeholder:"e.g., Spouse, Child",error:o(a).errors.relationship},null,8,["modelValue","error"]),i(h,{modelValue:o(a).email,"onUpdate:modelValue":e[4]||(e[4]=l=>o(a).email=l),type:"email",label:o(a).is_minor?"Email (Optional)":"Email (Required)",placeholder:"example@email.com",error:o(a).errors.email,required:!o(a).is_minor},null,8,["modelValue","label","error","required"])]),t("div",je,[i(h,{modelValue:o(a).phone_number,"onUpdate:modelValue":e[5]||(e[5]=l=>o(a).phone_number=l),label:o(a).is_minor?"Phone (Optional)":"Phone (Required)",placeholder:"07xx xxx xxx",error:o(a).errors.phone_number,required:!o(a).is_minor},null,8,["modelValue","label","error","required"])]),t("div",Se,[re(t("input",{id:"is_minor",type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=l=>o(a).is_minor=l),class:"h-4 w-4 text-purple-600 border-gray-300 rounded"},null,512),[[de,o(a).is_minor]]),e[13]||(e[13]=t("label",{for:"is_minor",class:"text-gray-700"},"Is Minor",-1))]),t("div",De,[t("button",{type:"submit",disabled:o(a).processing,class:"bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg flex items-center transition-colors duration-200"},u(o(a).processing?p.value?"Updating...":"Adding...":p.value?"Update Beneficiary":"Add Beneficiary"),9,Fe),t("button",{type:"button",onClick:e[7]||(e[7]=l=>p.value?q():f.value=!1),class:"bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg flex items-center transition-colors duration-200"}," Cancel ")])],32)])):b("",!0),w.beneficiaries.length>0?(r(),d("div",Ne,[e[19]||(e[19]=t("h3",{class:"text-lg font-semibold text-gray-900"},"Your Beneficiaries",-1)),t("div",Ue,[(r(!0),d(U,null,P(w.beneficiaries,l=>(r(),d("div",{key:l.id,class:"bg-white rounded-lg shadow-sm border p-6 hover:shadow-md transition-shadow"},[t("div",qe,[t("div",Me,[t("div",Oe,[i(o(R),{class:"w-6 h-6 text-blue-600 flex-shrink-0"}),t("div",null,[t("h4",Pe,u(l.full_name),1),t("p",Te,u(l.relationship||"Beneficiary"),1)])]),t("div",Ie,[l.national_id?(r(),d("div",Re,[e[14]||(e[14]=t("span",{class:"text-gray-500"},"ID:",-1)),g(" "+u(l.national_id),1)])):b("",!0),l.email?(r(),d("div",Le,[e[15]||(e[15]=t("span",{class:"text-gray-500"},"Email:",-1)),g(" "+u(l.email),1)])):b("",!0),l.phone_number?(r(),d("div",Ye,[e[16]||(e[16]=t("span",{class:"text-gray-500"},"Phone:",-1)),g(" "+u(l.phone_number),1)])):b("",!0),t("div",null,[e[17]||(e[17]=t("span",{class:"text-gray-500"},"Minor:",-1)),g(" "+u(l.is_minor?"Yes":"No"),1)])]),t("div",ze,[e[18]||(e[18]=t("span",{class:"text-gray-600 font-medium"},"Allocations:",-1)),t("span",null,u((w.assets||[]).filter(x=>(x.beneficiary_allocations||x.beneficiaryAllocations||[]).some(c=>{var M;return c.beneficiary_id===l.id||((M=c.beneficiary)==null?void 0:M.id)===l.id})).length)+" asset(s) ",1)])]),t("div",Ke,[t("button",{onClick:x=>z(l),class:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors duration-200",title:"Edit Beneficiary"},[i(o(ve),{class:"w-5 h-5"})],8,Ge),t("button",{onClick:x=>K(l),class:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors duration-200",title:"Delete Beneficiary"},[i(o(ye),{class:"w-5 h-5"})],8,Je)])])]))),128))])])):(r(),d("div",He,[i(o(R),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e[21]||(e[21]=t("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No beneficiaries added yet",-1)),e[22]||(e[22]=t("p",{class:"text-gray-600 mb-6"}," Add your first beneficiary to start assigning your assets. ",-1)),t("button",{onClick:e[8]||(e[8]=l=>{p.value=null,f.value=!0}),class:"bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg flex items-center transition-colors duration-200"},[i(o(T),{class:"w-5 h-5 mr-2"}),e[20]||(e[20]=g(" Add Your First Beneficiary "))])])),w.beneficiaries.length>0?(r(),d("div",Qe,[i(o(ue),{href:s.route("legacy.fiduciaries"),class:"bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg flex items-center transition-colors duration-200"},{default:N(()=>e[23]||(e[23]=[g(" Continue to Fiduciaries → ")])),_:1},8,["href"])])):b("",!0)])]),_:1})]),A.value?(r(),d("div",We,[t("div",Xe,[t("div",Ze,[e[26]||(e[26]=t("div",{class:"flex items-center mb-4"},[t("div",{class:"ml-3"},[t("h3",{class:"text-lg font-semibold text-gray-900"}," Delete Beneficiary ")])],-1)),t("div",et,[t("p",tt,[e[24]||(e[24]=g(" Are you sure you want to delete ")),t("strong",null,u((n=_.value)==null?void 0:n.full_name),1),e[25]||(e[25]=g("? If they are allocated to any asset, you must remove their allocations first. "))])]),t("div",st,[t("button",{onClick:G,disabled:o(a).processing,class:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg flex items-center transition-colors duration-200"},u(o(a).processing?"Deleting...":"Delete"),9,lt),t("button",{onClick:J,class:"bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg flex items-center transition-colors duration-200"}," Cancel ")])])])])):b("",!0),C.value?(r(),d("div",ot,[t("div",at,[t("div",it,[t("div",nt,[e[28]||(e[28]=t("h3",{class:"text-lg font-semibold text-gray-900"},"Manage Allocations",-1)),t("p",rt,[e[27]||(e[27]=g("Selected beneficiary: ")),t("strong",null,u((V=$.value)==null?void 0:V.full_name),1)])]),t("div",dt,[i(I,{modelValue:B.value,"onUpdate:modelValue":e[9]||(e[9]=l=>B.value=l),label:"Asset",options:H.value,error:"",required:""},null,8,["modelValue","options"]),t("div",{class:"flex items-end"},[t("button",{onClick:X,type:"button",class:"bg-purple-50 hover:bg-purple-100 text-purple-700 font-semibold py-2 px-3 rounded-lg transition-colors duration-200"}," + Add Beneficiary Allocation ")])]),E.value?(r(),d("div",ut,"Loading current allocations... ")):b("",!0),t("div",ct,[(r(!0),d(U,null,P(v.value,(l,x)=>(r(),d("div",{key:x,class:"grid md:grid-cols-6 gap-2 items-end"},[t("div",mt,[i(I,{modelValue:l.beneficiary_id,"onUpdate:modelValue":c=>l.beneficiary_id=c,label:"Beneficiary",options:Q.value,error:""},null,8,["modelValue","onUpdate:modelValue","options"])]),t("div",ft,[i(h,{modelValue:l.percentage,"onUpdate:modelValue":c=>l.percentage=c,type:"number",step:"0.01",min:"0",max:"100",label:"%"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",pt,[t("button",{onClick:c=>Z(x),type:"button",class:"text-red-600 hover:text-red-700 text-sm"},"Remove",8,gt)])]))),128))]),t("div",vt,[e[29]||(e[29]=g(" Total: ")),t("strong",{class:ce(j.value>100?"text-red-600":"text-gray-900")},u(j.value)+"%",3),e[30]||(e[30]=t("span",{class:"ml-2"},"(You can save partial allocations. Total must not exceed 100%.)",-1))]),t("div",yt,[t("button",{onClick:te,disabled:E.value,class:"bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg flex items-center transition-colors duration-200"}," Save Allocations ",8,bt),t("button",{onClick:e[10]||(e[10]=l=>C.value=!1),class:"bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg flex items-center transition-colors duration-200"}," Cancel ")])])])])):b("",!0)]}),_:1})],64))}};export{qt as default};
