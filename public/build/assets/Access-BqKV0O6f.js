import{C as U,r as c,k as v,b as i,o as l,d as $,f as u,u as d,m as z,w as B,a as e,j as N,v as I,F as f,i as h,g as T,t as n,l as D,h as y}from"./app-ChNJ9jXm.js";import{_ as q}from"./AdminSidebar-MCOWd8oz.js";import"./EllipsisHorizontalIcon-C1rOpLdZ.js";import"./ChartBarIcon-CYLFrdbt.js";import"./UserIcon-DyKo9MRs.js";import"./CalendarIcon-BC5zSnv8.js";import"./CalendarDaysIcon-Bc9tzu6O.js";import"./DocumentTextIcon-BhnZbcCX.js";import"./UserGroupIcon-DntsCjRx.js";import"./UsersIcon-BVTeKmmj.js";const K={class:"max-w-5xl mx-auto"},Q={class:"bg-white rounded-lg shadow p-6 mb-8"},H={class:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end"},J={class:"relative"},O={key:0,class:"absolute z-20 mt-1 w-full bg-white border border-gray-200 rounded-md shadow max-h-60 overflow-auto"},P=["onMousedown"],W={class:"text-sm text-gray-900"},X={class:"text-xs text-gray-500"},Y={key:0,class:"px-3 py-2 text-sm text-gray-500"},Z={key:1,class:"text-sm text-red-600 mt-1"},ee=["value"],se={key:0,class:"text-sm text-red-600 mt-1"},te=["disabled"],oe={key:0,class:"mt-3 text-sm text-red-600"},re={class:"bg-white rounded-lg shadow p-6"},ie={class:"overflow-x-auto"},le={class:"min-w-full divide-y divide-gray-200"},de={class:"bg-white divide-y divide-gray-200"},ne={class:"px-4 py-2 text-sm text-gray-900"},ae={class:"px-4 py-2 text-sm text-gray-500"},ue={class:"px-4 py-2 text-sm text-gray-900"},ce={class:"px-4 py-2 text-right"},me=["onClick"],pe={key:0},ge={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},xe={class:"relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6"},ve={class:"text-sm text-gray-800 mb-6"},fe={class:"flex justify-end gap-2"},ye=["disabled"],be={key:1,class:"fixed inset-0 z-50 flex items-center justify-center"},_e={class:"relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6"},we={class:"text-sm text-gray-600 mb-6"},ke={class:"font-medium"},he={class:"flex justify-end gap-2"},Ce=["disabled"],je={__name:"Access",props:{users:{type:Array,default:()=>[]},courses:{type:Array,default:()=>[]},access:{type:Array,default:()=>[]}},setup(M){const a=M,o=U({user_id:"",course_id:""}),C=U({}),p=c(""),m=c(!1),A=v(()=>{const r=p.value.trim().toLowerCase();return r?a.users.filter(s=>s.name&&s.name.toLowerCase().includes(r)||s.email&&s.email.toLowerCase().includes(r)).slice(0,10):a.users.slice(0,10)});function G(r){o.user_id=r.id,p.value=`${r.name} - ${r.email}`,m.value=!1}function L(){o.user_id="",m.value=!0}function R(){o.post(route("admin.courses.access.grant"),{preserveScroll:!0,onError:()=>{m.value=!0},onSuccess:()=>{g.value=!1}})}function V(r){C.delete(route("admin.courses.access.revoke",{id:r}),{preserveScroll:!0,onSuccess:()=>{x.value=!1,b.value=null,_.value=""}})}const g=c(!1),x=c(!1),b=c(null),_=c(""),w=v(()=>a.users.find(r=>String(r.id)===String(o.user_id))||null),S=v(()=>a.courses.find(r=>String(r.id)===String(o.course_id))||null),k=v(()=>!o.user_id||!o.course_id?!1:a.access.some(r=>String(r.user_id)===String(o.user_id)&&String(r.course_id)===String(o.course_id)));function j(){!o.user_id||!o.course_id||k.value||(g.value=!0)}function E(r){b.value=r.id,_.value=`${r.user_name} - ${r.course_title}`,x.value=!0}return(r,s)=>(l(),i(f,null,[$(d(z),{title:"Course Access"}),$(q,{title:"Manage Course Access"},{default:B(()=>[e("div",K,[e("div",Q,[s[9]||(s[9]=e("h2",{class:"text-lg font-semibold mb-4"},"Grant Access",-1)),e("div",H,[e("div",J,[s[6]||(s[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"User",-1)),N(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>p.value=t),onFocus:s[1]||(s[1]=t=>m.value=!0),onInput:L,type:"text",placeholder:"Type name or emailâ€¦",class:"w-full rounded-md border-gray-300 focus:ring-indigo-500 focus:border-indigo-500",autocomplete:"off"},null,544),[[I,p.value]]),m.value?(l(),i("div",O,[(l(!0),i(f,null,h(A.value,t=>(l(),i("button",{key:t.id,type:"button",onMousedown:T(F=>G(t),["prevent"]),class:"w-full text-left px-3 py-2 hover:bg-indigo-50"},[e("div",W,n(t.name),1),e("div",X,n(t.email),1)],40,P))),128)),A.value.length===0?(l(),i("div",Y," No matches ")):u("",!0)])):u("",!0),d(o).errors.user_id?(l(),i("div",Z,n(d(o).errors.user_id),1)):u("",!0)]),e("div",null,[s[8]||(s[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Course",-1)),N(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>d(o).course_id=t),class:"w-full rounded-md border-gray-300 focus:ring-indigo-500 focus:border-indigo-500"},[s[7]||(s[7]=e("option",{value:"",disabled:""},"Select course",-1)),(l(!0),i(f,null,h(a.courses,t=>(l(),i("option",{key:t.id,value:t.id},n(t.title)+" (KES "+n((t.price||0).toLocaleString())+") ",9,ee))),128))],512),[[D,d(o).course_id]]),d(o).errors.course_id?(l(),i("div",se,n(d(o).errors.course_id),1)):u("",!0)]),e("div",null,[e("button",{onClick:j,disabled:d(o).processing||!d(o).user_id||!d(o).course_id||k.value,class:"w-full md:w-auto px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-gray-300 disabled:text-gray-600"}," Grant Access ",8,te)])]),k.value?(l(),i("div",oe," User already has access to this course. ")):u("",!0)]),e("div",re,[s[12]||(s[12]=e("h2",{class:"text-lg font-semibold mb-4"},"Current Access",-1)),e("div",ie,[e("table",le,[s[11]||(s[11]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," User "),e("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Email "),e("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Course "),e("th",{class:"px-4 py-2"})])],-1)),e("tbody",de,[(l(!0),i(f,null,h(a.access,t=>(l(),i("tr",{key:t.id},[e("td",ne,n(t.user_name),1),e("td",ae,n(t.user_email),1),e("td",ue,n(t.course_title),1),e("td",ce,[e("button",{onClick:F=>E(t),class:"px-3 py-1.5 bg-red-600 hover:bg-red-700 text-white rounded-md text-sm"}," Revoke ",8,me)])]))),128)),a.access.length===0?(l(),i("tr",pe,s[10]||(s[10]=[e("td",{class:"px-4 py-6 text-center text-gray-500",colspan:"4"}," No access records yet. ",-1)]))):u("",!0)])])])])])]),_:1}),g.value?(l(),i("div",ge,[s[17]||(s[17]=e("div",{class:"absolute inset-0 bg-black/40"},null,-1)),e("div",xe,[s[15]||(s[15]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"Confirm Grant Access",-1)),s[16]||(s[16]=e("p",{class:"text-sm text-gray-600 mb-4"},"Grant lifetime access to:",-1)),e("ul",ve,[e("li",null,[s[13]||(s[13]=e("span",{class:"font-medium"},"User:",-1)),y(" "+n(w.value?w.value.name+" - "+w.value.email:"N/A"),1)]),e("li",null,[s[14]||(s[14]=e("span",{class:"font-medium"},"Course:",-1)),y(" "+n(S.value?S.value.title:"N/A"),1)])]),e("div",fe,[e("button",{onClick:s[3]||(s[3]=t=>g.value=!1),class:"px-4 py-2 rounded-md border border-gray-300 text-gray-700"},"Cancel"),e("button",{onClick:R,disabled:d(o).processing,class:"px-4 py-2 rounded-md bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-50"},"Confirm",8,ye)])])])):u("",!0),x.value?(l(),i("div",be,[s[21]||(s[21]=e("div",{class:"absolute inset-0 bg-black/40"},null,-1)),e("div",_e,[s[20]||(s[20]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"Confirm Revoke Access",-1)),e("p",we,[s[18]||(s[18]=y("Are you sure you want to revoke access for ")),e("span",ke,n(_.value),1),s[19]||(s[19]=y("?"))]),e("div",he,[e("button",{onClick:s[4]||(s[4]=t=>x.value=!1),class:"px-4 py-2 rounded-md border border-gray-300 text-gray-700"},"Cancel"),e("button",{onClick:s[5]||(s[5]=t=>V(b.value)),disabled:d(C).processing,class:"px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-700 disabled:opacity-50"},"Confirm",8,Ce)])])])):u("",!0)],64))}};export{je as default};
